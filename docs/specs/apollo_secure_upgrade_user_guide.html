
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Apollo Secure Upgrade SDK &#8212; Sphinx documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx13.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/translations.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="canonical" href="https://www.sphinx-doc.org/en/master/docs/specs/apollo_secure_upgrade_user_guide.html" />
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Sphinx documentation 中搜索"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.svg"/>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="Apollo安全更新SDK" href="apollo_secure_upgrade_user_guide_cn.html" />
    <link rel="prev" title="Apollo LiDAR - IMU Calibration Service" href="apollo_lidar_imu_calibration_guide.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script>
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../../README.html">Home</a></li>
    <li><a href="../quickstart/README.html">Get it</a></li>
    <li><a href="../../contents.html">Docs</a></li>
    <li><a href="../../development/index.html">Extend</a></li>
  </ul>
  <div>
    <a href="../../README.html">
      <img src="../../_static/sphinx.png" alt="Apollo Doc" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="apollo_secure_upgrade_user_guide_cn.html" title="Apollo安全更新SDK"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="apollo_lidar_imu_calibration_guide.html" title="Apollo LiDAR - IMU Calibration Service"
             accesskey="P">上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Apollo Secure Upgrade SDK</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">Apollo Secure Upgrade SDK</a><ul>
<li><a class="reference internal" href="#features">Features</a></li>
<li><a class="reference internal" href="#upgrade-procedure">Upgrade Procedure</a></li>
<li><a class="reference internal" href="#user-guide">User Guide</a><ul>
<li><a class="reference internal" href="#sdk-layout">1. SDK Layout</a></li>
<li><a class="reference internal" href="#interfaces">2. Interfaces</a><ul>
<li><a class="reference internal" href="#a-initialize">a) Initialize</a></li>
<li><a class="reference internal" href="#b-device-token-generation">b) Device Token Generation</a></li>
<li><a class="reference internal" href="#c-package-generation">c) Package Generation</a></li>
<li><a class="reference internal" href="#d-authorization-token-generation">d) Authorization Token Generation</a></li>
<li><a class="reference internal" href="#e-authorization-token-and-package-verification">e) Authorization Token and Package Verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-information">3. Additional Information</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="apollo_lidar_imu_calibration_guide.html"
                        title="上一章">Apollo LiDAR - IMU Calibration Service</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="apollo_secure_upgrade_user_guide_cn.html"
                        title="下一章">Apollo安全更新SDK</a></p>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/docs/specs/apollo_secure_upgrade_user_guide.md.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="apollo-secure-upgrade-sdk">
<h1>Apollo Secure Upgrade SDK<a class="headerlink" href="#apollo-secure-upgrade-sdk" title="永久链接至标题">¶</a></h1>
<p>Currently, most software upgrade solutions are not securely protected.
Therefore, devices are exposed to various security threats during the upgrade
procedure. Apollo secure upgrade SDK provides secure upgrade capabilities, and
can be easily integrated to make the upgrade process more secure and robust.</p>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="永久链接至标题">¶</a></h2>
<ol class="simple">
<li><p>Packages are encrypted and signature protected in storing and transmitting
phases.</p></li>
<li><p>Server and device can authenticate each other.</p></li>
<li><p>Cryptographic resources are protected properly.</p></li>
<li><p>Server provides customized authorizations to different devices.</p></li>
<li><p>Prevent attackers utilizing the server’s response to replay attack devices.</p></li>
<li><p>Multiple platforms (Ubuntu 14, Centos 6, Centos 7 and Andorid) are supported.</p></li>
</ol>
</section>
<section id="upgrade-procedure">
<h2>Upgrade Procedure<a class="headerlink" href="#upgrade-procedure" title="永久链接至标题">¶</a></h2>
<p>A typical upgrade procedure is shown below:</p>
<p><img alt="" src="../../_images/apollo_unsecure_upgrade_procedure.jpg" /></p>
<ol class="simple">
<li><p>The upgrade server generates the upgrade package.</p></li>
<li><p>Packages are uploaded to the storage server.</p></li>
<li><p>Storage server sends the package URL to upgrade server.</p></li>
<li><p>Device sends the upgrade request to upgrade server.</p></li>
<li><p>Upgrade server replies package URL to the device.</p></li>
<li><p>Device requests package from the storage server.</p></li>
<li><p>Packages are downloaded to device.</p></li>
<li><p>Device installs the package.</p></li>
</ol>
<p>After integrating secure upgrade SDK, the upgrade procedure is modified as
follows:</p>
<p><img alt="" src="../../_images/apollo_secure_upgrade_procedure.jpg" /></p>
<ol class="simple">
<li><p>The upgrade server generates the secure package and package token.</p></li>
<li><p>Secure packages and the package token are uploaded to the storage server.</p></li>
<li><p>The storage server sends secure package and package token URLs to the upgrade
server.</p></li>
<li><p>The device generates the device token and sends to the upgrade server with
the upgrade request.</p></li>
<li><p>The upgrade server generates authorization token and sends the token to the
device with a replied secure package URL.</p></li>
<li><p>Device requests secure package from the storage server.</p></li>
<li><p>Secure packages are downloaded to device.</p></li>
<li><p>Device verifies the secure package with the authorization token, and
generates the original package.</p></li>
<li><p>Device installs the package.</p></li>
</ol>
</section>
<section id="user-guide">
<h2>User Guide<a class="headerlink" href="#user-guide" title="永久链接至标题">¶</a></h2>
<section id="sdk-layout">
<h3>1. SDK Layout<a class="headerlink" href="#sdk-layout" title="永久链接至标题">¶</a></h3>
<p>SDK contains four directories:</p>
<ol class="simple">
<li><p>python API: python interface.</p></li>
<li><p>config: SDK root configuration file, log file.</p></li>
<li><p>certificate: certificate file.</p></li>
<li><p>depend_lib: dependency libraries.</p></li>
</ol>
</section>
<section id="interfaces">
<h3>2. Interfaces<a class="headerlink" href="#interfaces" title="永久链接至标题">¶</a></h3>
<section id="a-initialize">
<h4>a) Initialize<a class="headerlink" href="#a-initialize" title="永久链接至标题">¶</a></h4>
<p>This function should be called before using secure upgrade APIs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">init_secure_upgrade</span><span class="p">(</span><span class="n">root_config_path</span><span class="p">)</span>
<span class="nb">input</span> <span class="n">para</span><span class="p">:</span>
  <span class="n">root_config_path</span>  <span class="n">root</span> <span class="n">configuration</span> <span class="n">file</span> <span class="n">path</span>
</pre></div>
</div>
</section>
<section id="b-device-token-generation">
<h4>b) Device Token Generation<a class="headerlink" href="#b-device-token-generation" title="永久链接至标题">¶</a></h4>
<p>This function is used to generate the device token.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sec_upgrade_get_device_token</span><span class="p">()</span>
<span class="n">Output</span> <span class="n">para</span><span class="p">:</span>
  <span class="k">return</span> <span class="n">code</span><span class="p">:</span> <span class="n">true</span>    <span class="n">generating</span> <span class="n">device</span> <span class="n">token</span> <span class="n">successfully</span>
               <span class="n">false</span>    <span class="n">generating</span> <span class="n">device</span> <span class="n">token</span> <span class="n">failed</span>
  <span class="n">Device_token</span><span class="p">:</span> <span class="n">device</span> <span class="n">token</span> <span class="p">(</span><span class="n">string</span> <span class="nb">format</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="c-package-generation">
<h4>c) Package Generation<a class="headerlink" href="#c-package-generation" title="永久链接至标题">¶</a></h4>
<p>This function is used to generate the secure upgrade package and package token.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sec_upgrade_get_package</span><span class="p">(</span><span class="n">original_package_path</span><span class="p">,</span>
                        <span class="n">secure_package_path</span><span class="p">,</span>
                        <span class="n">package_token_path</span><span class="p">)</span>
<span class="nb">input</span> <span class="n">para</span><span class="p">:</span>
    <span class="n">original_package_path</span>    <span class="n">original</span> <span class="n">upgrade</span> <span class="n">package</span> <span class="n">file</span> <span class="n">path</span>
    <span class="n">secure_package_path</span>    <span class="n">secure</span> <span class="n">upgrade</span> <span class="n">package</span> <span class="n">file</span> <span class="n">path</span>
    <span class="n">package_token_path</span>    <span class="n">secure</span> <span class="n">package</span> <span class="n">token</span> <span class="n">file</span>
<span class="n">output</span> <span class="n">para</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">code</span><span class="p">:</span>
        <span class="n">true</span>    <span class="n">generating</span> <span class="n">secure</span> <span class="n">upgrade</span> <span class="n">package</span> <span class="n">successfully</span>
        <span class="n">false</span>    <span class="n">generating</span> <span class="n">secure</span> <span class="n">upgrade</span> <span class="n">package</span> <span class="n">failed</span>
</pre></div>
</div>
</section>
<section id="d-authorization-token-generation">
<h4>d) Authorization Token Generation<a class="headerlink" href="#d-authorization-token-generation" title="永久链接至标题">¶</a></h4>
<p>This function is used to generate a device’s authorization token, based on
device token and package token.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sec_upgrade_get_authorization_token</span><span class="p">(</span><span class="n">package_token_path</span><span class="p">,</span>
                                    <span class="n">device_token_path</span><span class="p">)</span>
<span class="nb">input</span> <span class="n">para</span><span class="p">:</span>
    <span class="n">package_token_path</span>    <span class="n">secure</span> <span class="n">package</span> <span class="n">token</span> <span class="n">file</span> <span class="n">path</span>
	<span class="n">device_token_path</span>    <span class="n">device</span> <span class="n">token</span> <span class="n">file</span> <span class="n">path</span>
<span class="n">output_para</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">code</span><span class="p">:</span>
        <span class="n">true</span>    <span class="n">generating</span> <span class="n">authorization</span> <span class="n">token</span> <span class="n">successfully</span>
        <span class="n">false</span>    <span class="n">generating</span> <span class="n">authorization</span> <span class="n">token</span> <span class="n">failed</span>
        <span class="n">authorization_token</span> <span class="n">authorization</span> <span class="n">token</span> <span class="n">buffer</span><span class="p">(</span><span class="n">string</span> <span class="n">formate</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="e-authorization-token-and-package-verification">
<h4>e) Authorization Token and Package Verification<a class="headerlink" href="#e-authorization-token-and-package-verification" title="永久链接至标题">¶</a></h4>
<p>This function is used to verify the downloaded secure package with the
authorization token and generate the original package.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sec_upgrade_verify_package</span><span class="p">(</span><span class="n">authorization_token_buffer</span><span class="p">,</span>
                           <span class="n">secure_package_path</span><span class="p">)</span>
<span class="nb">input</span> <span class="n">para</span><span class="p">:</span>
    <span class="n">authorization_token_buffer</span>    <span class="n">authorization</span> <span class="n">token</span> <span class="n">buffer</span><span class="p">(</span><span class="n">string</span> <span class="nb">format</span><span class="p">)</span>
    <span class="n">secure_package_path</span>    <span class="n">secure</span> <span class="n">upgrade</span> <span class="n">package</span> <span class="n">file</span> <span class="n">path</span>
<span class="n">output</span> <span class="n">para</span><span class="p">:</span>
    <span class="n">original_package_path</span>    <span class="n">original</span> <span class="n">upgrade</span> <span class="n">package</span> <span class="n">file</span> <span class="n">path</span>
</pre></div>
</div>
</section>
</section>
<section id="additional-information">
<h3>3. Additional Information<a class="headerlink" href="#additional-information" title="永久链接至标题">¶</a></h3>
<ol class="simple">
<li><p>SDK uses standard PEM certificates.</p></li>
<li><p>Before using SDK, users need to generate two seperate chains of certificate
for server and device.</p></li>
<li><p>Certificates from the server certificate chain are deployed to server and
make sure they cannot sign other certificates.</p></li>
<li><p>Certificates from the device certificate chain are deployed to device and
make sure they cannot sign other certificates.</p></li>
<li><p>Root private key should not be deployed to server or devices.</p></li>
<li><p>Users need to be assigned the read and write permissions of the <code class="docutils literal notranslate"><span class="pre">config</span></code>
directory and the read permission of the <code class="docutils literal notranslate"><span class="pre">certificate</span></code> directory.</p></li>
</ol>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="apollo_secure_upgrade_user_guide_cn.html" title="Apollo安全更新SDK"
             >下一页</a> |</li>
        <li class="right" >
          <a href="apollo_lidar_imu_calibration_guide.html" title="Apollo LiDAR - IMU Calibration Service"
             >上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Apollo Secure Upgrade SDK</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2021, xinetzone.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>