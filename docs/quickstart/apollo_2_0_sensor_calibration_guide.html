
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Apollo 2.0 Sensor Calibration Guide &#8212; Sphinx documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx13.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/translations.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="canonical" href="https://www.sphinx-doc.org/en/master/docs/quickstart/apollo_2_0_sensor_calibration_guide.html" />
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Sphinx documentation 中搜索"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.svg"/>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="Apollo 2.0 传感器标定方法使用指南" href="apollo_2_0_sensor_calibration_guide_cn.html" />
    <link rel="prev" title="Apollo 2.0 快速入门指南" href="apollo_2_0_quick_start_cn.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script>
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../../README.html">Home</a></li>
    <li><a href="README.html">Get it</a></li>
    <li><a href="../../contents.html">Docs</a></li>
    <li><a href="../../development/index.html">Extend</a></li>
  </ul>
  <div>
    <a href="../../README.html">
      <img src="../../_static/sphinx.png" alt="Apollo Doc" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="apollo_2_0_sensor_calibration_guide_cn.html" title="Apollo 2.0 传感器标定方法使用指南"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="apollo_2_0_quick_start_cn.html" title="Apollo 2.0 快速入门指南"
             accesskey="P">上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Apollo 2.0 Sensor Calibration Guide</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">Apollo 2.0 Sensor Calibration Guide</a><ul>
<li><a class="reference internal" href="#about-this-guide">About This Guide</a></li>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#preparation">Preparation</a><ul>
<li><a class="reference internal" href="#well-calibrated-intrinsics-of-camera">Well Calibrated Intrinsics of Camera</a></li>
<li><a class="reference internal" href="#initial-extrinsic-file">Initial Extrinsic File</a></li>
<li><a class="reference internal" href="#calibration-site">Calibration Site</a></li>
<li><a class="reference internal" href="#required-topics">Required Topics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-calibration-tools">Using the Calibration Tools</a><ul>
<li><a class="reference internal" href="#camera-to-camera-calibration-tool">Camera-to-Camera Calibration Tool</a></li>
<li><a class="reference internal" href="#camera-to-lidar-calibration">Camera-to-LiDAR Calibration</a></li>
<li><a class="reference internal" href="#radar-to-camera-calibration">Radar-to-Camera Calibration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#imu-to-vehicle-calibration">IMU-to-Vehicle Calibration</a><ul>
<li><a class="reference internal" href="#optional-run-all-calibration-tools">(Optional) Run All Calibration Tools</a></li>
</ul>
</li>
<li><a class="reference internal" href="#obtaining-calibration-results">Obtaining Calibration Results</a></li>
<li><a class="reference internal" href="#validation-methods-and-results">Validation Methods and Results</a><ul>
<li><a class="reference internal" href="#camera-to-camera-calibration">Camera-to-Camera Calibration</a></li>
<li><a class="reference internal" href="#id1">Camera-to-LiDAR Calibration</a></li>
<li><a class="reference internal" href="#id2">Radar-to-Camera Calibration</a><ul>
<li><a class="reference internal" href="#radar-lidar-visualizer-projection-tool"><strong>Radar LiDAR Visualizer Projection Tool</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="apollo_2_0_quick_start_cn.html"
                        title="上一章">Apollo 2.0 快速入门指南</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="apollo_2_0_sensor_calibration_guide_cn.html"
                        title="下一章">Apollo 2.0 传感器标定方法使用指南</a></p>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/docs/quickstart/apollo_2_0_sensor_calibration_guide.md.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="apollo-2-0-sensor-calibration-guide">
<h1>Apollo 2.0 Sensor Calibration Guide<a class="headerlink" href="#apollo-2-0-sensor-calibration-guide" title="永久链接至标题">¶</a></h1>
<p>This guide introduces the Apollo Sensor Calibration Service and describes the three new calibration tools in Apollo 2.0:</p>
<ul class="simple">
<li><p>Camera-to-Camera Calibration</p></li>
<li><p>Camera-to-LiDAR Calibration</p></li>
<li><p>Radar-to-Camera Calibration</p></li>
<li><p>IMU-to-Vehicle Calibration</p></li>
</ul>
<section id="about-this-guide">
<h2>About This Guide<a class="headerlink" href="#about-this-guide" title="永久链接至标题">¶</a></h2>
<p>This guide provides the following information:</p>
<ul class="simple">
<li><p>Overview</p></li>
<li><p>Preparation</p></li>
<li><p>Using the Calibration Tools</p></li>
<li><p>Obtaining Calibration Results</p></li>
<li><p>Validation Methods and Results</p></li>
</ul>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="永久链接至标题">¶</a></h2>
<p>The new calibration tools in Apollo 2.0 (Camera-to-Camera Calibration, Camera-to-LiDAR Calibration, and Radar-to-Camera Calibration) are provided by an onboard executable program.For LiDAR-GNSS calibration, please refer to the <a class="reference external" href="https://github.com/ApolloAuto/apollo/blob/master/docs/specs/apollo_lidar_imu_calibration_guide.md">LiDAR-IMU calibration guide</a>. Velodyne HDL-64 users can also use the calibration service in Apollo 1.5.
The benefit in using these tools is that they reduce the amount of work that the user must do. The user only has to start the corresponding calibration program, and the calibration work is performed and completes in real time. The user can then verify the calibration results, which are provided as <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> files.</p>
</section>
<section id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="永久链接至标题">¶</a></h2>
<p>Download <a class="reference external" href="https://github.com/ApolloAuto/apollo/releases/download/v2.0.0/calibration.tar.gz">calibration tools</a>, and extract files to <code class="docutils literal notranslate"><span class="pre">$APOLLO_HOME/modules/calibration</span></code>. APOLLO_HOME is the root directory of apollo repository.</p>
<section id="well-calibrated-intrinsics-of-camera">
<h3>Well Calibrated Intrinsics of Camera<a class="headerlink" href="#well-calibrated-intrinsics-of-camera" title="永久链接至标题">¶</a></h3>
<p>Camera intrinsics contain focus length, principal points, distortion coefficients, and other information. Users can obtain the intrinsics from other camera calibration tools such as the <a class="reference external" href="http://wiki.ros.org/camera_calibration/Tutorials/MonocularCalibration">ROS Camera Calibration Tools</a> and the <a class="reference external" href="http://www.vision.caltech.edu/bouguetj/calib_doc/">Camera Calibration Toolbox for Matlab</a>. After the calibration is completed, <em><strong>users should convert the result to a specific <code class="docutils literal notranslate"><span class="pre">yaml</span></code> format file manually</strong></em>.</p>
<p>Users must ensure that the <code class="docutils literal notranslate"><span class="pre">K</span></code> and <code class="docutils literal notranslate"><span class="pre">D</span></code> data is correct:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">K</span></code> refers to the camera matrix</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">D</span></code> refers to the distortion parameters</p></li>
</ul>
<p>The following is an example of a camera intrinsic file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>    header: 
      seq: <span class="m">0</span>
      stamp: 
      secs: <span class="m">0</span>
        nsecs: <span class="m">0</span>
      frame_id: short_camera
    height: <span class="m">1080</span>
    width: <span class="m">1920</span>
    distortion_model: plumb_bob
    D: <span class="o">[</span>-0.535253, <span class="m">0</span>.259291, <span class="m">0</span>.004276, -0.000503, <span class="m">0</span>.0<span class="o">]</span>
    K: <span class="o">[</span><span class="m">1959</span>.678185, <span class="m">0</span>.0, <span class="m">1003</span>.592207, <span class="m">0</span>.0, <span class="m">1953</span>.786100, <span class="m">507</span>.820634, <span class="m">0</span>.0, <span class="m">0</span>.0, <span class="m">1</span>.0<span class="o">]</span>
    R: <span class="o">[</span><span class="m">1</span>.0, <span class="m">0</span>.0, <span class="m">0</span>.0, <span class="m">0</span>.0, <span class="m">1</span>.0, <span class="m">0</span>.0, <span class="m">0</span>.0, <span class="m">0</span>.0, <span class="m">1</span>.0<span class="o">]</span>
    P: <span class="o">[</span><span class="m">1665</span>.387817, <span class="m">0</span>.0, <span class="m">1018</span>.703332, <span class="m">0</span>.0, <span class="m">0</span>.0, <span class="m">1867</span>.912842, <span class="m">506</span>.628623, <span class="m">0</span>.0, <span class="m">0</span>.0, <span class="m">0</span>.0, <span class="m">1</span>.0, <span class="m">0</span>.0<span class="o">]</span>
    binning_x: <span class="m">0</span>
    binning_y: <span class="m">0</span>
    roi: 
      x_offset: <span class="m">0</span>
      y_offset: <span class="m">0</span>
      height: <span class="m">0</span>
      width: <span class="m">0</span>
      do_rectify: False
</pre></div>
</div>
<p>It is recommended that you perform the intrinsic calibration for every single camera instead of using unified intrinsic parameters for every camera. If you follow this practice, you can improve the accuracy of the extrinsic calibration results.</p>
</section>
<section id="initial-extrinsic-file">
<h3>Initial Extrinsic File<a class="headerlink" href="#initial-extrinsic-file" title="永久链接至标题">¶</a></h3>
<p>The tools require the user to provide an initial extrinsic value as a reference.</p>
<p>The following is an example of an initial extrinsic file of Camera-to-LiDAR, where <code class="docutils literal notranslate"><span class="pre">translation</span></code> is the shift distance between the camera and LiDAR. The <code class="docutils literal notranslate"><span class="pre">rotation</span></code> is the quaternion expression form of the rotation matrix.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>    header:
      seq: <span class="m">0</span>
      stamp:
        secs: <span class="m">0</span>
        nsecs: <span class="m">0</span>
      frame_id: velodyne64
    child_frame_id: short_camera
    transform:
      rotation:
        y: <span class="m">0</span>.5
        x: -0.5
        w: <span class="m">0</span>.5
        z: -0.5
      translation:
        x: <span class="m">0</span>.0
        y: <span class="m">1</span>.5
        z: <span class="m">2</span>.0
</pre></div>
</div>
<p><strong>NOTE:</strong> The Camera-to-LiDAR Calibration is more dependent on initial extrinsic values. <em><strong>A large deviation can lead to calibration failure.</strong></em> Therefore, it is essential that you provide the most accurate, initial extrinsic value as conditions allow.</p>
</section>
<section id="calibration-site">
<h3>Calibration Site<a class="headerlink" href="#calibration-site" title="永久链接至标题">¶</a></h3>
<p>Because the Camera-to-LiDAR Calibration method is used in natual environment, a good location can significantly improve the accuracy of the calibration. It is recommended that you select a calibration site that includes objects such as trees, poles, street lights, traffic signs, stationary objects, and clear traffic lines.</p>
<p>Figure 1 is an example of a good choice for a calibration site:</p>
<p><img alt="" src="../../_images/calibration_place.png" /></p>
  <p align="center"> Figure 1. Good Choice for a Calibration Site </p>
</section>
<section id="required-topics">
<h3>Required Topics<a class="headerlink" href="#required-topics" title="永久链接至标题">¶</a></h3>
<p>Users must confirm that all sensor topics required by the program have output messages. For more information, see: <a class="reference external" href="https://github.com/ApolloAuto/apollo/blob/master/docs/FAQs/Calibration_FAQs.md">How to Check the Sensor Output?</a></p>
<p>The sensor topics that the on-board program requires are listed in Tables 1, 2, and 3.</p>
<p><strong>Table 1. The Required Topics of Camera-to-Camera Calibration</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Sensor</p></th>
<th class="head"><p>Topic Name</p></th>
<th class="head"><p>Topic Feq. (Hz)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Short_Camera</p></td>
<td><p>/apollo/sensor/camera/traffic/image_short</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>Long_Camera</p></td>
<td><p>/apollo/sensor/camera/traffic/image_long</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>INS</p></td>
<td><p>/apollo/sensor/gnss/odometry</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-odd"><td><p>INS</p></td>
<td><p>/apollo/sensor/gnss/ins_stat</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
<p><strong>Table 2. The Required Topics of Camera-to-LiDAR Calibration</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Sensor</p></th>
<th class="head"><p>Topic Name</p></th>
<th class="head"><p>Topic Feq. (Hz)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Short_Camera</p></td>
<td><p>/apollo/sensor/camera/traffic/image_short</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>LiDAR</p></td>
<td><p>/apollo/sensor/velodyne64/compensator/PointCloud2</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>INS</p></td>
<td><p>/apollo/sensor/gnss/odometry</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-odd"><td><p>INS</p></td>
<td><p>/apollo/sensor/gnss/ins_stat</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
<p><strong>Table 3. The Required Topics of Radar-to-Camera Calibration</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Sensor</p></th>
<th class="head"><p>Topic Name</p></th>
<th class="head"><p>Topic Feq. (Hz)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Short_Camera</p></td>
<td><p>/apollo/sensor/camera/traffic/image_short</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>INS</p></td>
<td><p>/apollo/sensor/gnss/odometry</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-even"><td><p>INS</p></td>
<td><p>/apollo/sensor/gnss/ins_stat</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="using-the-calibration-tools">
<h2>Using the Calibration Tools<a class="headerlink" href="#using-the-calibration-tools" title="永久链接至标题">¶</a></h2>
<p>This section provides the following information to use the three calibration tools:</p>
<ul class="simple">
<li><p>Commands to run each tool</p></li>
<li><p>Data collection guidelines</p></li>
<li><p>Location of the configuration file</p></li>
<li><p>Types of data output</p></li>
</ul>
<p>Before you begin to use the tools, you must verify that the localization status is <em><strong>56</strong></em> or the calibration tools (programs) will <em><strong>not</strong></em> collect data.</p>
<p>Type the following command to check localization status:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rostopic <span class="nb">echo</span> /apollo/sensor/gnss/ins_stat
</pre></div>
</div>
<section id="camera-to-camera-calibration-tool">
<h3>Camera-to-Camera Calibration Tool<a class="headerlink" href="#camera-to-camera-calibration-tool" title="永久链接至标题">¶</a></h3>
<ol class="simple">
<li><p>Run the Camera-to-Camera Calibration Tool using these commands:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /apollo/scripts
bash sensor_calibration.sh camera_camera
</pre></div>
</div>
<ol class="simple">
<li><p>Follow these guidelines to collect data:</p></li>
</ol>
<ul class="simple">
<li><p>Because the two cameras have different timestamps, they cannot be completely synchronized, so it is important to drive the vehicle very slowly when recording the data. The slow speed of the vehicle can effectively alleviate the image mismatch that is caused by the different timestamps.</p></li>
<li><p>Make sure to enable a large enough overlap of the regions of the two camera images or the tool will <em><strong>not</strong></em> be able to perform the extrinsic calibration operation.</p></li>
</ul>
<ol class="simple">
<li><p>Note the location of the configuration file:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/apollo/modules/calibration/camera_camera_calibrator/camera_camera_calibrtor.conf
</pre></div>
</div>
<p>Table 4 identifies and describes each element in the configuration file.</p>
<p><strong>Table 4. Camera-to-Camera Calibration Configuration Description</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Configuration</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>long_image_topic</p></td>
<td><p>telephoto camera image topic</p></td>
</tr>
<tr class="row-odd"><td><p>short_image_topic</p></td>
<td><p>wide-angle camera image topic</p></td>
</tr>
<tr class="row-even"><td><p>odometry_topic</p></td>
<td><p>vehicle vodometry topic</p></td>
</tr>
<tr class="row-odd"><td><p>ins_stat_topic</p></td>
<td><p>vehicle locolization status topic</p></td>
</tr>
<tr class="row-even"><td><p>long_camera_intrinsics_filename</p></td>
<td><p>intrinsic file of telephoto camera</p></td>
</tr>
<tr class="row-odd"><td><p>short_camera_intrinsics_filename</p></td>
<td><p>intrinsic file of wide-angle camera</p></td>
</tr>
<tr class="row-even"><td><p>init_extrinsics_filename</p></td>
<td><p>initial extrinsic file</p></td>
</tr>
<tr class="row-odd"><td><p>output_path</p></td>
<td><p>calibration results output path</p></td>
</tr>
<tr class="row-even"><td><p>max_speed_kmh</p></td>
<td><p>limitation of max vehicle speed, unit: km/h</p></td>
</tr>
</tbody>
</table>
<ol class="simple">
<li><p>The types of output from the Camera-to-Camera Calibration Tool are:</p></li>
</ol>
<ul class="simple">
<li><p>The calibrated extrinsic file, provided as a <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> file.</p></li>
<li><p>Validation images that include:</p>
<ul>
<li><p>An image captured by the telephoto camera.</p></li>
<li><p>An image captured by the wide-angle camera.</p></li>
<li><p>A warp image blended with an undistorted wide-angle camera image and an undistorted telephoto camera image.</p></li>
</ul>
</li>
</ul>
</section>
<section id="camera-to-lidar-calibration">
<h3>Camera-to-LiDAR Calibration<a class="headerlink" href="#camera-to-lidar-calibration" title="永久链接至标题">¶</a></h3>
<ol class="simple">
<li><p>Run the Camera-to-LiDAR Calibration Tool using these commands:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /apollo/scripts
bash sensor_calibration.sh lidar_camera
</pre></div>
</div>
<ol class="simple">
<li><p>Follow these guidelines to collect data:</p></li>
</ol>
<ul class="simple">
<li><p>Because the two cameras have different timestamps, they cannot be completely synchronized, so it is important to drive the vehicle very slowly when recording the data. The slow speed of the vehicle can effectively alleviate the image mismatch that is caused by the different timestamps.</p></li>
<li><p>Make sure that there are a certain number of (over 500) projection points in the camera image, or the tool <em><strong>cannot</strong></em> perform the extrinsic calibration operation. For this reason, this tool is only for wide angle cameras.</p></li>
</ul>
<ol class="simple">
<li><p>Note the location of the saved configuration file:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/apollo/modules/calibration/lidar_camera_calibrator/camera_camera_calibrtor.conf
</pre></div>
</div>
<p>Table 5 identifies and describes each element in the configuration file.</p>
<p><strong>Table 5. Camera-to-LiDAR Calibration Configuration Description</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Configuration</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>camera_topic</p></td>
<td><p>wide-angle camera image topic</p></td>
</tr>
<tr class="row-odd"><td><p>lidar_topic</p></td>
<td><p>LiDAR point cloud topic</p></td>
</tr>
<tr class="row-even"><td><p>odometry_topic</p></td>
<td><p>vehicle odometry topic</p></td>
</tr>
<tr class="row-odd"><td><p>ins_stat_topic</p></td>
<td><p>vehicle localization status topic</p></td>
</tr>
<tr class="row-even"><td><p>camera_intrinsics_filename</p></td>
<td><p>intrinsic file of camera</p></td>
</tr>
<tr class="row-odd"><td><p>init_extrinsics_filename</p></td>
<td><p>initial extrinsic file</p></td>
</tr>
<tr class="row-even"><td><p>output_path</p></td>
<td><p>calibration results output path</p></td>
</tr>
<tr class="row-odd"><td><p>calib_stop_count</p></td>
<td><p>required stops of capturing data</p></td>
</tr>
<tr class="row-even"><td><p>max_speed_kmh</p></td>
<td><p>limitation of max vehicle speed, unit: km/h</p></td>
</tr>
</tbody>
</table>
<ol class="simple">
<li><p>The types of output from the Camera-to-LiDAR Calibration Tool are:</p></li>
</ol>
<ul class="simple">
<li><p>The calibrated extrinsic file, provided as a <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> file</p></li>
<li><p>Two validation images that project the LiDAR point cloud onto a camera image:</p>
<ul>
<li><p>One image is colored with depth</p></li>
<li><p>One image is colored with intensity</p></li>
</ul>
</li>
</ul>
</section>
<section id="radar-to-camera-calibration">
<h3>Radar-to-Camera Calibration<a class="headerlink" href="#radar-to-camera-calibration" title="永久链接至标题">¶</a></h3>
<ol class="simple">
<li><p>Run the Radar-to-Camera Calibration Tool using these commands:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /apollo/scripts
bash sensor_calibration.sh radar_camera
</pre></div>
</div>
<ol class="simple">
<li><p>Follow this guideline to collect data:</p></li>
</ol>
<p>Drive the vehicle at a low speed and in a straight line to enable the calibration tool to capture data only under this set of conditions.</p>
<ol class="simple">
<li><p>Note the location of the saved configuration file:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/apollo/modules/calibration/radar_camera_calibrator/conf/radar_camera_calibrtor.conf
</pre></div>
</div>
<p>Table 6 identifies and describes each element in the configuration file.</p>
<p><strong>Table 6. Radar-to-Camera Calibration Configuration Description</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Configuration</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>camera_topic</p></td>
<td><p>wide angle camera image topic</p></td>
</tr>
<tr class="row-odd"><td><p>odometry_topic</p></td>
<td><p>vehicle odometry topic</p></td>
</tr>
<tr class="row-even"><td><p>ins_stat_topic</p></td>
<td><p>vehicle locolization status topic</p></td>
</tr>
<tr class="row-odd"><td><p>camera_intrinsics_filename</p></td>
<td><p>intrinsic file of camera</p></td>
</tr>
<tr class="row-even"><td><p>init_extrinsics_filename</p></td>
<td><p>initial extrinsic file</p></td>
</tr>
<tr class="row-odd"><td><p>output_path</p></td>
<td><p>calibration results output path</p></td>
</tr>
<tr class="row-even"><td><p>max_speed_kmh</p></td>
<td><p>limitation of max vehicle speed, unit: km/h</p></td>
</tr>
</tbody>
</table>
<ol class="simple">
<li><p>The types of output from the Radar-to-Camera Calibration tool are:</p></li>
</ol>
<ul class="simple">
<li><p>The calibrated extrinsic file, provided as a <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> file</p></li>
<li><p>A validation image that includes the projection result from Radar-to-LiDAR.
You need to run the <code class="docutils literal notranslate"><span class="pre">radar_lidar_visualizer</span></code> tool to generate the image.
See [Radar LiDAR Visualizer Projection Tool](####Radar LiDAR Visualizer Projection Tool) for more information.</p></li>
</ul>
</section>
</section>
<section id="imu-to-vehicle-calibration">
<h2>IMU-to-Vehicle Calibration<a class="headerlink" href="#imu-to-vehicle-calibration" title="永久链接至标题">¶</a></h2>
<ol class="simple">
<li><p>Download the <a class="reference external" href="https://apollocache.blob.core.windows.net/apollo-cache/imu_car_calibrator.zip">calibration tool</a>.</p></li>
<li><p>Start the vehicle to move before calibration. The vehicle should keep going straight at speed of 3m/s for 10s at least.  There is no need to provide the intrinsic and initial extrinsic.</p></li>
<li><p>Required topic: INS /apollo/sensors/gnss/odemetry 100Hz</p></li>
<li><p>Run the IMU-to-Vehicle Calibration using these commands:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /apollo
bash scripts/sensor_calibration.sh imu_vehicle
</pre></div>
</div>
<ol class="simple">
<li><p>The result is saved as vehicle_imu_extrinsics.yaml in current path. Here is an example:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>    header
      seq: <span class="m">0</span>
      stamp:
        secs: <span class="m">1522137131</span>
        nsecs: <span class="m">319999933</span>
      frame_id: imu
    transform:
      translation:
        x: <span class="m">0</span>.0
        y: <span class="m">0</span>.0
        z: <span class="m">0</span>.0
      rotation:
        x: -0.008324888458427
        y: -0.000229845441991
        z: <span class="m">0</span>.027597957866274
        w: <span class="m">0</span>.999584411705604
    child_frame_id: vehicle

    <span class="c1">#pitch install error: -0.954337</span>
    <span class="c1">#roll install error: 0.000000</span>
    <span class="c1">#yaw install error: 3.163004</span>
</pre></div>
</div>
<section id="optional-run-all-calibration-tools">
<h3>(Optional) Run All Calibration Tools<a class="headerlink" href="#optional-run-all-calibration-tools" title="永久链接至标题">¶</a></h3>
<p>If necessary, users can run all calibration tools using these commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /apollo/scripts
bash sensor_calibration.sh all
</pre></div>
</div>
</section>
</section>
<section id="obtaining-calibration-results">
<h2>Obtaining Calibration Results<a class="headerlink" href="#obtaining-calibration-results" title="永久链接至标题">¶</a></h2>
<p>All calibration results are saved under the  <code class="docutils literal notranslate"><span class="pre">output</span></code> path in the configuration files, and they are provided in <code class="docutils literal notranslate"><span class="pre">yaml</span></code> format. In addition, depending on the sensor, the calibration results are stored in different folders in the <code class="docutils literal notranslate"><span class="pre">output</span></code> directory as shown in Table 7:</p>
<p><strong>Table 7. Path of Saved Calibration Results for Each Sensor</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Sensor</p></th>
<th class="head"><p>Path for Saved Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Short_Camera</p></td>
<td><p>[output]/camera_params</p></td>
</tr>
<tr class="row-odd"><td><p>Long_Camera</p></td>
<td><p>[output]/camera_params</p></td>
</tr>
<tr class="row-even"><td><p>Radar</p></td>
<td><p>[output]/radar_params</p></td>
</tr>
</tbody>
</table>
</section>
<section id="validation-methods-and-results">
<h2>Validation Methods and Results<a class="headerlink" href="#validation-methods-and-results" title="永久链接至标题">¶</a></h2>
<p>When the calibration is complete, the corresponding calibration result verification image is generated in the <code class="docutils literal notranslate"><span class="pre">[output]/validation</span></code> directory.</p>
<p>This section provides the background information and the corresponding validation method to use to evaluate verification images for each calibration tool.</p>
<section id="camera-to-camera-calibration">
<h3>Camera-to-Camera Calibration<a class="headerlink" href="#camera-to-camera-calibration" title="永久链接至标题">¶</a></h3>
<ul>
<li><p><strong>Background Information:</strong>
In the warp image, the green channel is produced from the wide-angle camera image, and the red and blue channels are produced from the telephoto camera image. Users can compare the alignment result of the warp image to validate the precision of the calibrated extrinsic parameter.</p></li>
<li><p><strong>Validation Method:</strong></p>
<p>In the fusion area of the warp image, judge the alignment of the scene 50 meters away from the vehicle. If the images coincide completely, the extrinsic parameter is satisfactory. However, if a pink or green ghost (displacement) appears, the extrinsic parameter is in error.</p>
<p>When the error is greater than a certain range (for example, 20 pixels, determined by the actual usage), you need to re-calibrate the extrinsic parameter. Under general circumstances, due to the parallax, some dislocations may occur in the horizontal with close objects, but the vertical direction is not affected. This is a normal phenomenon.</p>
</li>
<li><p>**Examples: **As shown in the following examples, Figure 2 meets the precision requirements of the extrinsic parameter, and Figure 3 does not.</p></li>
</ul>
<p><img alt="" src="../../_images/cam_cam_good.png" />
<a align="center"> Figure 2. Good Calibration Result for Camera-to-Camera Calibration </p></p>
<p><img alt="" src="../../_images/cam_cam_error.png" />
<a align="center"> Figure 3. Bad Calibration Result for Camera-to-Camera Calibration</p></p>
</section>
<section id="id1">
<h3>Camera-to-LiDAR Calibration<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p><strong>Background Information:</strong>
In the point cloud projection images, users can see objects and signs with obvious edges and compare the alignment.</p></li>
<li><p><strong>Validation Method:</strong>
If the target is within 50 meters, its edge of point cloud can coincide with the edge of the image, and the accuracy of the calibration results can be proved to be very high. However, if there is a misplacement, the calibration results are in error. The extrinsic parameter is <em><strong>not</strong></em> available when the error is greater than a certain range (for example, 5 pixels, depending on the actual usage).</p></li>
<li><p><strong>Examples:</strong>
As shown in the following examples, Figure 4 meets the precision requirements of the extrinsic parameter, and Figure 5 does not.</p></li>
</ul>
<p><img alt="" src="../../_images/cam_lidar_good.png" /></p>
<p align="center"> Figure 4. Good Camera-to-LiDAR Calibration Validation Result </p>
<p><img alt="" src="../../_images/cam_lidar_error.png" /></p>
<p align="center"> Figure 5. Bad Camera-to-LiDAR Calibration Validation Result </p>
</section>
<section id="id2">
<h3>Radar-to-Camera Calibration<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<ul>
<li><p><strong>Background Information:</strong>
To verify the extrinsic output, use the LiDAR in the system as a medium. This approach enables you to obtain:</p>
<ul>
<li><p>The extrinsic parameter of the radar relative to the LiDAR through the extrinsic value of the radar relative to the camera</p></li>
<li><p>The extrinsic value of the camera relative to the LiDAR</p>
<p>You can then draw a bird’s-eye-view fusion image, which fuses the radar data and the LiDAR data in the LiDAR coordinate system. You can use the alignment of the radar data and the LiDAR data in the bird’s-eye-view fusion image to judge the accuracy of the extrinsic parameter. In the fusion image, all of the small white points indicate the LiDAR point cloud, while the large green solid circles indicate radar objects.</p>
</li>
</ul>
</li>
<li><p><strong>Validation Method:</strong></p>
<p>The alignment of the radar object and the LiDAR data in the bird’s-eye-view fusion image shows the accuracy of the extrinsic parameter. If most of the targets coincide, it is satisfactory. However, if over 40% targets (especially vehicles) <em><strong>do not</strong></em> align, it is <em><strong>not</strong></em> satisfactory and you need to re-calibrate.</p>
</li>
<li><p><strong>Examples:</strong>
As shown in the following examples, Figure 6 meets the precision requirements of the extrinsic parameter, and Figure 7 does not.</p></li>
</ul>
<p><img alt="" src="../../_images/radar_cam_good.png" /></p>
<p align="center"> Figure 6. Good Camera-to-Radar Calibration Validation Result </p>
<p><img alt="" src="../../_images/radar_cam_error.png" /></p>
<p align="center"> Figure 7. Bad Camera-to-Radar Calibration Validation Result </p>
<section id="radar-lidar-visualizer-projection-tool">
<h4><strong>Radar LiDAR Visualizer Projection Tool</strong><a class="headerlink" href="#radar-lidar-visualizer-projection-tool" title="永久链接至标题">¶</a></h4>
<p>To obtain the fusion image of the radar data and the LiDAR point cloud, the calibration process automatically (if using <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">sensor_calibration.sh</span> <span class="pre">all</span></code>) or manually (if using <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">sensor_calibration.sh</span> <span class="pre">visualizer</span></code>) calls another projection tool, the <code class="docutils literal notranslate"><span class="pre">radar_lidar_visualizer</span></code>. The projection tool loads the extrinsic files of the Radar-to-Camera and the Camera-to-LiDAR.</p>
<p><strong>IMPORTANT:</strong> Before the projection tool starts, make sure that the two extrinsic parameters are well calibrated and exist in the specific path set in the configuration file (<code class="docutils literal notranslate"><span class="pre">radar_camera_extrinsics_filename</span></code> and <code class="docutils literal notranslate"><span class="pre">camera_lidar_extrinsics_filename</span></code>).</p>
<ol class="simple">
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">radar_lidar_visualizer</span></code> program using these commands:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">apollo</span><span class="o">/</span><span class="n">scripts</span>
<span class="n">bash</span> <span class="n">sensor_calibration</span><span class="o">.</span><span class="n">sh</span> <span class="n">visualizer</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Note the saved location of the configuration file of <code class="docutils literal notranslate"><span class="pre">radar_lidar_visualizer</span></code>:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/apollo/modules/calibration/radar_lidar_visualizer/conf/radar_lidar_visualizer.conf
</pre></div>
</div>
<p>Table 8 identifies and describes each element in the projection tool configuration file.</p>
<p><strong>Table 8. Projection Tool Radar-to-LiDAR Configuration Description</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Configuration File</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>radar_topic</p></td>
<td><p>Radar data topic</p></td>
</tr>
<tr class="row-odd"><td><p>lidar_topic</p></td>
<td><p>LiDAR point cloud topic</p></td>
</tr>
<tr class="row-even"><td><p>radar_camera_extrinsics_filename</p></td>
<td><p>Calibrated extrinsic of Radar-to-Camera</p></td>
</tr>
<tr class="row-odd"><td><p>camera_lidar_extrinsics_filename</p></td>
<td><p>Calibrated extrinsic of Camera-to-LiDAR</p></td>
</tr>
<tr class="row-even"><td><p>output_path</p></td>
<td><p>Validation results output path</p></td>
</tr>
</tbody>
</table>
<ol>
<li><p>Note the location of the saved validation image:</p>
<p><code class="docutils literal notranslate"><span class="pre">[output]/validation</span></code></p>
</li>
</ol>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="apollo_2_0_sensor_calibration_guide_cn.html" title="Apollo 2.0 传感器标定方法使用指南"
             >下一页</a> |</li>
        <li class="right" >
          <a href="apollo_2_0_quick_start_cn.html" title="Apollo 2.0 快速入门指南"
             >上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Apollo 2.0 Sensor Calibration Guide</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2021, xinetzone.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>