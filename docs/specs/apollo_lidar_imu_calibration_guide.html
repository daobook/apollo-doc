
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Apollo LiDAR - IMU Calibration Service &#8212; Sphinx documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx13.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/translations.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="canonical" href="https://www.sphinx-doc.org/en/master/docs/specs/apollo_lidar_imu_calibration_guide.html" />
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Sphinx documentation 中搜索"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.svg"/>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="Apollo Secure Upgrade SDK" href="apollo_secure_upgrade_user_guide.html" />
    <link rel="prev" title="Apollo Build and Test Explained" href="apollo_build_and_test_explained.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script>
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../../README.html">Home</a></li>
    <li><a href="../quickstart/README.html">Get it</a></li>
    <li><a href="../../contents.html">Docs</a></li>
    <li><a href="../../development/index.html">Extend</a></li>
  </ul>
  <div>
    <a href="../../README.html">
      <img src="../../_static/sphinx.png" alt="Apollo Doc" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="apollo_secure_upgrade_user_guide.html" title="Apollo Secure Upgrade SDK"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="apollo_build_and_test_explained.html" title="Apollo Build and Test Explained"
             accesskey="P">上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Apollo LiDAR - IMU Calibration Service</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">Apollo LiDAR - IMU Calibration Service</a><ul>
<li><a class="reference internal" href="#apollo-sensor-calibration-catalog">Apollo Sensor Calibration Catalog</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#preparing-the-sensors">Preparing the Sensors</a></li>
<li><a class="reference internal" href="#recording-calibration-data">Recording Calibration Data</a></li>
<li><a class="reference internal" href="#uploading-calibration-data-and-creating-a-calibration-service-task">Uploading Calibration Data and Creating a Calibration Service Task</a></li>
<li><a class="reference internal" href="#obtaining-calibration-results">Obtaining Calibration Results</a></li>
<li><a class="reference internal" href="#types-of-errors-encountered">Types of Errors encountered</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="apollo_build_and_test_explained.html"
                        title="上一章">Apollo Build and Test Explained</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="apollo_secure_upgrade_user_guide.html"
                        title="下一章">Apollo Secure Upgrade SDK</a></p>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/docs/specs/apollo_lidar_imu_calibration_guide.md.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="apollo-lidar-imu-calibration-service">
<h1>Apollo LiDAR - IMU Calibration Service<a class="headerlink" href="#apollo-lidar-imu-calibration-service" title="永久链接至标题">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Note</span><span class="p">:</span>
<span class="n">This</span> <span class="n">guide</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span> <span class="n">version</span> <span class="n">Apollo</span> <span class="mf">3.5</span>
</pre></div>
</div>
<p>Welcome to the Apollo sensor calibration service. This document describes the process of the extrinsic calibration service between 64-beam Light Detection And Ranging (LiDAR) and Inertial Navigation System (INS).</p>
<section id="apollo-sensor-calibration-catalog">
<h2>Apollo Sensor Calibration Catalog<a class="headerlink" href="#apollo-sensor-calibration-catalog" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="#overview">Overview</a></p></li>
<li><p><a class="reference external" href="#preparing-the-sensors">Preparing the Sensors</a></p></li>
<li><p><a class="reference external" href="#recording-calibration-data">Recording calibration data</a></p></li>
<li><p><a class="reference external" href="#uploading-calibration-data-and-creating-a-calibration-service-task">Uploading Calibration Data and Creating a Calibration Service Task</a></p></li>
<li><p><a class="reference external" href="#obtaining-calibration-results">Obtaining calibration results</a></p></li>
<li><p><a class="reference external" href="#types-of-errors">Types of Errors encountered</a></p></li>
</ul>
<section id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="永久链接至标题">¶</a></h3>
<p>The Apollo vehicle sensor calibration function provides the extrinsic calibration between Velodyne HDL-64ES3 and IMU. The calibration results can be used to transfer the obstacle location detected by LiDAR to the IMU coordinate system, and then to the world coordinate system. The results are provided in <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> format files.</p>
</section>
<section id="preparing-the-sensors">
<h3>Preparing the Sensors<a class="headerlink" href="#preparing-the-sensors" title="永久链接至标题">¶</a></h3>
<p>In order to calibrate the sensors, it is important to prepare them first, using the following steps:</p>
<ol class="simple">
<li><p>Install 64-beams LiDAR and INS supported by Apollo, and then deploy the Docker environment.</p></li>
<li><p>Start up the 64-beams LiDAR and INS. The INS must be aligned when it is powered on. At this point, the car should be driven straight, then turned left and turned right in an open area, until the initialization is completed.</p></li>
<li><p>Confirm that all sensor topics required by this service have the following output : <a class="reference internal" href="../FAQs/Calibration_FAQs.html"><span class="doc std std-doc">How to Check the Sensor Output?</span></a></p></li>
</ol>
<p>The topics required by the calibration service are shown in the following Table 1:</p>
<p>Table 1. Sensor topics.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Sensor</p></th>
<th class="head"><p>Topic Name</p></th>
<th class="head"><p>Topic Feq. (Hz)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HDL-64ES3</p></td>
<td><p>/apollo/sensor/velodyne64/VelodyneScanUnified</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>INS</p></td>
<td><p>/apollo/sensor/gnss/odometry</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-even"><td><p>INS</p></td>
<td><p>/apollo/sensor/gnss/ins_stat</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
<ol class="simple">
<li><p>Confirm that the INS status is 56 when recording data. To learn how please go to : <a class="reference internal" href="../FAQs/Calibration_FAQs.html"><span class="doc std std-doc">How to Check INS Status?</span></a></p></li>
<li><p>Choose an appropriate calibration field.</p></li>
</ol>
<div class="highlight-An notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p><img alt="" src="../../_images/trajectory1.png" /></p>
<p align="center">Figure 1. The trajectory  for calibration.</p>
<p><img alt="" src="../../_images/field1.png" /></p>
<p align="center">Figure 2. Calibration field.</p>
</section>
<section id="recording-calibration-data">
<h3>Recording Calibration Data<a class="headerlink" href="#recording-calibration-data" title="永久链接至标题">¶</a></h3>
<p>After the preparation steps are completed, drive the vehicle to the calibration field to record the calibration data.</p>
<ol class="simple">
<li><p>The recording script is <code class="docutils literal notranslate"><span class="pre">apollo/script/lidar_calibration.sh</span></code>.</p></li>
<li><p>Run the following command to record data:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>  bash lidar_calibration.sh start_record
</pre></div>
</div>
<p>The recorded bag is under the directory <code class="docutils literal notranslate"><span class="pre">apollo/data/bag</span></code>.</p>
<ol class="simple">
<li><p>Drive the car following a ∞ symbol path, using a controlled speed of 20-40km/h, and make the turning radius as small as possible. The total time length should within 3 minutes, but please make sure that your calibration drive contains at least one full ∞ symbol path.</p></li>
<li><p>After recording, run the following command to stop the data recording:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>  bash lidar_calibration.sh stop_record
</pre></div>
</div>
<ol class="simple">
<li><p>Then, the program will detect whether or not the recorded bag contains all the required topics. After passing the test, the bag will be packaged into file <code class="docutils literal notranslate"><span class="pre">lidar_calib_data.tar.gz</span></code>, including the recorded rosbag and the corresponding MD5 checksum file.</p></li>
</ol>
</section>
<section id="uploading-calibration-data-and-creating-a-calibration-service-task">
<h3>Uploading Calibration Data and Creating a Calibration Service Task<a class="headerlink" href="#uploading-calibration-data-and-creating-a-calibration-service-task" title="永久链接至标题">¶</a></h3>
<p>After recording the calibration data, please login to the <a class="reference external" href="https://console.bce.baidu.com/apollo/calibrator/index/list">calibration service page</a> to complete the calibration.</p>
<ol class="simple">
<li><p>Enter the calibration service page and click the <strong>New Task</strong> button under the <strong>Task Management</strong> list to create a new calibration task.</p></li>
<li><p>After entering the New Task page, you need to fill in a simple description of this task. Then click the <strong>Upload and create a task</strong> button and select the upload calibration file to start uploading the calibration data.</p></li>
<li><p>After you start uploading the data, the page will display the Task Process View. The process figure is the upload progress page. The task will start to calibrate when the upload progress reaches 100%. Please keep the network unblocked during uploading.</p></li>
<li><p>When the data is uploaded, the Data Verification Process will begin, as shown in Figure 3. The validation process ensures data integrity and suitability. The validation list include:</p></li>
</ol>
<ul class="simple">
<li><p>Decompress test</p></li>
<li><p>MD5 checksum</p></li>
<li><p>Data format validation</p></li>
<li><p>∞ symbol path validation</p></li>
<li><p>INS status validation</p></li>
</ul>
<p>If validation fails, the corresponding error message is prompted as seen in the third Result of the Data Validation screen below in Figure 3.</p>
<p><img alt="" src="../../_images/calib_valid_en.png" /></p>
<p align="center">Figure 3. Calibration data verification.</p>
<ol class="simple">
<li><p>After data validation, the calibration process begins, as shown in Figure 4.  A detailed calibration progress page is displayed to users. Depending on the size and quality of the data, the overall calibration time lasts about 10 - 30 minutes. You can check the progress at any time by opening the given page.
<img alt="" src="../../_images/calib_progress_en.png" /></p></li>
</ol>
<p align="center">Figure 4. Calibration progress page.</p>
<ol class="simple">
<li><p>When calibration succeeds, click the <strong>View detail</strong> button to display a stitched point cloud. You can confirm the quality verification by checking the sharpness of the point cloud. If you are satisfied with the calibration quality, you can click <strong>Confirm</strong> to keep the result and download the calibration results by clicking <strong>Download</strong>. This fulfills the completion of the calibration process.</p></li>
</ol>
<p>For additional information, see: <a class="reference internal" href="../FAQs/Calibration_FAQs.html"><span class="doc std std-doc">How to Check Point Cloud Quality?</span></a></p>
</section>
<section id="obtaining-calibration-results">
<h3>Obtaining Calibration Results<a class="headerlink" href="#obtaining-calibration-results" title="永久链接至标题">¶</a></h3>
<ol class="simple">
<li><p>Before obtaining the calibration results, the service requires that you confirm the quality of the calibration results based on visualized point cloud.</p></li>
<li><p>After confirming the quality of the calibration result, you can click on the <strong>Confirm</strong> button to store the calibration result. After that, you can download the result on the Task page. The <strong>Download</strong> button will <em>NOT</em> appear on the task page if the result failed to pass quality verification.</p></li>
<li><p>Extrinsic file format instruction —  The extrinsic is returned to you in a <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> format file. We can look an at example of the format of the extrinsic file below:</p></li>
</ol>
<p>The field meanings shown in this example are defined in Table 2.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>header:
  seq: <span class="m">0</span>
  stamp:
	 secs: <span class="m">1504765807</span>
	 nsecs: <span class="m">0</span>
  frame_id: novatel
child_frame_id: velodyne64
transform:
  rotation:
    x: <span class="m">0</span>.02883904659307384
	 y: -0.03212457531272153
	 z: <span class="m">0</span>.697030811535172
	 w: <span class="m">0</span>.7157404339725393
  translation:
	 x: <span class="m">0</span>.000908140840832566
	 y: <span class="m">1</span>.596564931858745
	 z: <span class="m">1</span>
</pre></div>
</div>
<p>Table 2. Definition of the keys in the yaml file</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">header</span></code></p></td>
<td><p>Header information, including timestamps.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">child_frame_id</span></code></p></td>
<td><p>Source sensor ID in calibration. Will be HDL-64ES3 here.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">frame_id</span></code></p></td>
<td><p>Target sensor ID in calibration. Will be Novatel here.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">rotation</span></code></p></td>
<td><p>Rotation part of the extrinsic parameters. Represented by a quaternion.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">translation</span></code></p></td>
<td><p>Translation part of the extrinsic parameters.</p></td>
</tr>
</tbody>
</table>
<ol class="simple">
<li><p>How to use extrinsic parameters?</p></li>
</ol>
<p>Enter the following command to create the calibration file directory in the apollo directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p modules/calibration/data/<span class="o">[</span>CAR_ID<span class="o">]</span>/
</pre></div>
</div>
<p>Here, <strong>CAR_ID</strong> is the vehicle ID for calibrating vehicles. Then, copy the downloaded extrinsic yaml file to the corresponding <strong>CAR_ID</strong> folder. Finally, after you start HMI, select the correct <strong>CAR_ID</strong> to load the corresponding calibration yaml file.</p>
</section>
<section id="types-of-errors-encountered">
<h3>Types of Errors encountered<a class="headerlink" href="#types-of-errors-encountered" title="永久链接至标题">¶</a></h3>
<ol class="simple">
<li><p><strong>Data unpacking error</strong>: The uploaded data is not a valid <code class="docutils literal notranslate"><span class="pre">tar.gz</span></code> file</p></li>
<li><p><strong>MD5 checksum error</strong>:  If the MD5 checksum of the uploaded data differs from the MD5 checksum computed by the server side, it could be caused by network transmission problems.</p></li>
<li><p><strong>Data format error</strong>:  The uploaded data is not a rosbag, or necessary topics are missing or unexpected topics exist. The server-side calibration program failed to read it.</p></li>
<li><p><strong>No ∞ symbol path error</strong>:  No ∞ symbol path was found in the uploaded data. Verify that the recorded data contains at least one ∞ symbol path.</p></li>
<li><p><strong>INS status error</strong>:  In the uploaded data, the location does not meet the requirement. Ensure that the INS status is 56 during the data recording.</p></li>
</ol>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="apollo_secure_upgrade_user_guide.html" title="Apollo Secure Upgrade SDK"
             >下一页</a> |</li>
        <li class="right" >
          <a href="apollo_build_and_test_explained.html" title="Apollo Build and Test Explained"
             >上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Apollo LiDAR - IMU Calibration Service</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2021, xinetzone.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>