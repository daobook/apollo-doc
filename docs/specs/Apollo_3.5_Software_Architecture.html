
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Apollo 3.5 Software Architecture &#8212; Sphinx documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx13.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/translations.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="canonical" href="https://www.sphinx-doc.org/en/master/docs/specs/Apollo_3.5_Software_Architecture.html" />
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Sphinx documentation 中搜索"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.svg"/>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="Apollo 5.5 Software Architecture" href="Apollo_5.5_Software_Architecture.html" />
    <link rel="prev" title="Apollo 3.0 软件架构" href="Apollo_3.0_Software_Architecture_cn.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script>
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../../README.html">Home</a></li>
    <li><a href="../quickstart/README.html">Get it</a></li>
    <li><a href="../../contents.html">Docs</a></li>
    <li><a href="../../development/index.html">Extend</a></li>
  </ul>
  <div>
    <a href="../../README.html">
      <img src="../../_static/sphinx.png" alt="Apollo Doc" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="Apollo_5.5_Software_Architecture.html" title="Apollo 5.5 Software Architecture"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="Apollo_3.0_Software_Architecture_cn.html" title="Apollo 3.0 软件架构"
             accesskey="P">上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Apollo 3.5 Software Architecture</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">Apollo 3.5 Software Architecture</a><ul>
<li><a class="reference internal" href="#perception">Perception</a></li>
<li><a class="reference internal" href="#prediction">Prediction</a></li>
<li><a class="reference internal" href="#localization">Localization</a></li>
<li><a class="reference internal" href="#routing">Routing</a></li>
<li><a class="reference internal" href="#planning">Planning</a></li>
<li><a class="reference internal" href="#control">Control</a></li>
<li><a class="reference internal" href="#canbus">CanBus</a></li>
<li><a class="reference internal" href="#hmi">HMI</a></li>
<li><a class="reference internal" href="#monitor">Monitor</a></li>
<li><a class="reference internal" href="#guardian">Guardian</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="Apollo_3.0_Software_Architecture_cn.html"
                        title="上一章">Apollo 3.0 软件架构</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="Apollo_5.5_Software_Architecture.html"
                        title="下一章">Apollo 5.5 Software Architecture</a></p>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/docs/specs/Apollo_3.5_Software_Architecture.md.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="apollo-3-5-software-architecture">
<h1>Apollo 3.5 Software Architecture<a class="headerlink" href="#apollo-3-5-software-architecture" title="永久链接至标题">¶</a></h1>
<p>Core software modules running on the Apollo 3.5 powered autonomous vehicle include:</p>
<ul class="simple">
<li><p><strong>Perception</strong> — The perception module identifies the world surrounding the autonomous vehicle. There are two important submodules inside perception: obstacle detection and traffic light detection.</p></li>
<li><p><strong>Prediction</strong> — The prediction module anticipates the future motion trajectories of the perceived obstacles.</p></li>
<li><p><strong>Routing</strong> — The routing module tells the autonomous vehicle how to reach its destination via a series of lanes or roads.</p></li>
<li><p><strong>Planning</strong> — The planning module plans the spatio-temporal trajectory for the autonomous vehicle to take.</p></li>
<li><p><strong>Control</strong> — The control module executes the planned spatio-temporal trajectory by generating control commands such as throttle, brake, and steering.</p></li>
<li><p><strong>CanBus</strong> — The CanBus is the interface that passes control commands to the vehicle hardware. It also passes chassis information to the software system.</p></li>
<li><p><strong>HD-Map</strong> — This module is similar to a library. Instead of publishing and subscribing messages, it frequently functions as query engine support to provide ad-hoc structured information regarding the roads.</p></li>
<li><p><strong>Localization</strong> — The localization module leverages various information sources such as GPS, LiDAR and IMU to estimate where the autonomous vehicle is located.</p></li>
<li><p><strong>HMI</strong> - Human Machine Interface or DreamView in Apollo is a module for viewing the status of the vehicle, testing other modules and controlling the functioning of the vehicle in real-time.</p></li>
<li><p><strong>Monitor</strong> - The surveillance system of all the modules in the vehicle including hardware.</p></li>
<li><p><strong>Guardian</strong> - A new safety module that performs the function of an Action Center and intervenes should Monitor detect a failure.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Note</span><span class="p">:</span> <span class="n">Detailed</span> <span class="n">information</span> <span class="n">on</span> <span class="n">each</span> <span class="n">of</span> <span class="n">these</span> <span class="n">modules</span> <span class="ow">is</span> <span class="n">included</span> <span class="n">below</span><span class="o">.</span>
</pre></div>
</div>
<p>The interactions of these modules are illustrated in the picture below.</p>
<p><img alt="img" src="../../_images/Apollo_3_5_software_architecture.png" /></p>
<p>Every module is running as a separate CarOS-based ROS node. Each module node publishes and subscribes certain topics. The subscribed topics serve as data input while the published topics serve as data output. The detailed interactions are described in the following sections.</p>
<section id="perception">
<h2>Perception<a class="headerlink" href="#perception" title="永久链接至标题">¶</a></h2>
<p>Apollo Perception 3.5 has following new features:</p>
<ul class="simple">
<li><p><strong>Support for VLS-128 Line LiDAR</strong></p></li>
<li><p><strong>Obstacle detection through multiple cameras</strong></p></li>
<li><p><strong>Advanced traffic light detection</strong></p></li>
<li><p><strong>Configurable sensor fusion</strong></p></li>
</ul>
<p>The perception module incorporates the capability of using 5 cameras (2 front, 2 on either side and 1 rear) and 2 radars (front and rear) along with 3 16-line LiDARs (2 rear and 1 front) and 1 128-line LiDAR to recognize obstacles and fuse their individual tracks to obtain a final track list. The obstacle sub-module detects, classifies and tracks obstacles. This sub-module also predicts obstacle motion and position information (e.g., heading and velocity). For lane line, we construct lane instances by postprocessing lane parsing pixels and calculate the lane relative location to the ego-vehicle (L0, L1, R0, R1, etc.).</p>
</section>
<section id="prediction">
<h2>Prediction<a class="headerlink" href="#prediction" title="永久链接至标题">¶</a></h2>
<p>The prediction module estimates the future motion trajectories for all the perceived obstacles. The output prediction message wraps the perception information. Prediction subscribes to localization, planning and perception obstacle messages as shown below.</p>
<p><img alt="img" src="../../_images/pred.png" /></p>
<p>When a localization update is received, the prediction module updates its internal status. The actual prediction is triggered when perception sends out its perception obstacle message.</p>
</section>
<section id="localization">
<h2>Localization<a class="headerlink" href="#localization" title="永久链接至标题">¶</a></h2>
<p>The localization module aggregates various data to locate the autonomous vehicle. There are two types of localization modes: OnTimer and Multiple SensorFusion.</p>
<p>The first localization method is RTK-based, with a timer-based callback function <code class="docutils literal notranslate"><span class="pre">OnTimer</span></code>, as shown below.</p>
<p><img alt="img" src="../../_images/localization1.png" /></p>
<p>The other localization method is the Multiple Sensor Fusion (MSF) method, where a bunch of event-triggered callback functions are registered, as shown  below.</p>
<p><img alt="img" src="../../_images/localization2.png" /></p>
</section>
<section id="routing">
<h2>Routing<a class="headerlink" href="#routing" title="永久链接至标题">¶</a></h2>
<p>The routing module needs to know the routing start point and routing end point, to compute the passage lanes and roads. Usually the routing start point is the autonomous vehicle location. The <code class="docutils literal notranslate"><span class="pre">RoutingResponse</span></code> is computed and published as shown below.</p>
<p><img alt="img" src="../../_images/routing1.png" /></p>
</section>
<section id="planning">
<h2>Planning<a class="headerlink" href="#planning" title="永久链接至标题">¶</a></h2>
<p>Apollo 3.5 uses several information sources to plan a safe and collision free trajectory, so the planning module interacts with almost every other module. As Apollo matures and takes on different road conditions and driving use cases, planning has evolved to a more modular, scenario specific and wholistic approach. In this approach, each driving use case is treated as a different driving scenario. This is useful because an issue now reported in a particular scenario can be fixed without affecting the working of other scenarios as opposed to the previous versions, wherein an issue fix affected other driving use cases as they were all treated as a single driving scenario.</p>
<p>Initially, the planning module takes the prediction output. Because the prediction output wraps the original perceived obstacle, the planning module subscribes to the traffic light detection output rather than the perception obstacles output.</p>
<p>Then, the planning module takes the routing output. Under certain scenarios, the planning module might also trigger a new routing computation by sending a routing request if the current route cannot be faithfully followed.</p>
<p>Finally, the planning module needs to know the location (Localization: where I am) as well as the current autonomous vehicle information (Chassis: what is my status).</p>
<p><img alt="img" src="../../_images/planning1.png" /></p>
</section>
<section id="control">
<h2>Control<a class="headerlink" href="#control" title="永久链接至标题">¶</a></h2>
<p>The Control takes the planned trajectory as input, and generates the control command to pass to CanBus.  It has five main data interfaces: OnPad, OnMonitor, OnChassis, OnPlanning and OnLocalization.</p>
<p><img alt="img" src="../../_images/control1.png" /></p>
<p>The <code class="docutils literal notranslate"><span class="pre">OnPad</span></code> and <code class="docutils literal notranslate"><span class="pre">OnMonitor</span></code> are routine interactions with the PAD-based human interface and simulations.</p>
</section>
<section id="canbus">
<h2>CanBus<a class="headerlink" href="#canbus" title="永久链接至标题">¶</a></h2>
<p>The CanBus has two data interfaces as shown below.</p>
<p><img alt="img" src="../../_images/canbus1.png" /></p>
<p>The first one is the <code class="docutils literal notranslate"><span class="pre">OnControlCommand</span></code> which is an event-based publisher with a callback function, which is triggered when the CanBus module receives control commands and the second one is <code class="docutils literal notranslate"><span class="pre">OnGuardianCommand</span></code>.</p>
</section>
<section id="hmi">
<h2>HMI<a class="headerlink" href="#hmi" title="永久链接至标题">¶</a></h2>
<p>Human Machine Interface or DreamView in Apollo is a web application that:
-	visualizes the current output of relevant autonomous driving modules, e.g. planning trajectory, car localization, chassis status, etc.
-	provides human-machine interface for user to view hardware status, turn on/off of modules, and start the autonomous driving car.
-	provides debugging tools, such as PnC Monitor to efficiently track module issues.</p>
</section>
<section id="monitor">
<h2>Monitor<a class="headerlink" href="#monitor" title="永久链接至标题">¶</a></h2>
<p>The surveillance system of all the modules in the vehicle including hardware. Monitor receives Data from different modules and passes them on to HMI for the driver to view and ensure that all the modules are working without any issue. In the event of a module or hardware failure, monitor sends an alert to Guardian (new Action Center Module) which then decides on which action needs to be taken to prevent a crash.</p>
</section>
<section id="guardian">
<h2>Guardian<a class="headerlink" href="#guardian" title="永久链接至标题">¶</a></h2>
<p>This new module is basically an action center that takes a decision based on the data that is sent by Monitor. There are 2 main functions of Guardian:</p>
<ul class="simple">
<li><p>All modules working fine - Guardian allows the flow of control to work normally. Control signals are sent to CANBus as if Guardian were not present.</p></li>
<li><p>Module crash is detected by Monitor - if there is a failure detected by Monitor, Guardian will prevent Control signals from reaching CANBus and bring the car to a stop. There are 3 ways in which Guardian decides how to stop the car, and to do so, Guardian turns to the final Gatekeeper, Ultrasonic sensors,</p>
<ul>
<li><p>If the Ultrasonic sensor is running fine without detecting an obstacle, Guardian will bring the car to a slow stop</p></li>
<li><p>If the sensor is not responding, Guardian applies a hard brake to bring the car to an immediate stop.</p></li>
<li><p>This is a special case, If the HMI informs the driver of an impending crash and the driver does not intervene for 10 seconds, Guardian applies a hard brake to bring the car to an immediate stop.</p></li>
</ul>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Note</span><span class="p">:</span> 
<span class="mf">1.</span> <span class="n">In</span> <span class="n">either</span> <span class="n">case</span> <span class="n">above</span><span class="p">,</span> <span class="n">Guardian</span> <span class="n">will</span> <span class="n">always</span> <span class="n">stop</span> <span class="n">the</span> <span class="n">car</span> <span class="n">should</span> <span class="n">Monitor</span> <span class="n">detect</span> <span class="n">a</span> <span class="n">failure</span> <span class="ow">in</span> <span class="nb">any</span> <span class="n">module</span> <span class="ow">or</span> <span class="n">hardware</span><span class="o">.</span>
<span class="mf">2.</span> <span class="n">Monitor</span> <span class="ow">and</span> <span class="n">Guardian</span> <span class="n">are</span> <span class="n">decoupled</span> <span class="n">to</span> <span class="n">ensure</span> <span class="n">that</span> <span class="n">there</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">single</span> <span class="n">point</span> <span class="n">of</span> <span class="n">failure</span> <span class="ow">and</span> <span class="n">also</span> <span class="n">that</span> <span class="k">with</span> <span class="n">a</span> <span class="n">module</span> <span class="n">approach</span><span class="p">,</span> <span class="n">the</span> <span class="n">action</span> <span class="n">center</span> <span class="n">can</span> <span class="n">be</span> <span class="n">modified</span> <span class="n">to</span> <span class="n">include</span> <span class="n">additional</span> <span class="n">actions</span> <span class="n">without</span> <span class="n">affecting</span> <span class="n">the</span> <span class="n">functioning</span> <span class="n">of</span> <span class="n">the</span> <span class="n">surveillance</span> <span class="n">system</span> <span class="k">as</span> <span class="n">Monitor</span> <span class="n">also</span> <span class="n">communicates</span> <span class="k">with</span> <span class="n">HMI</span><span class="o">.</span>

</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="Apollo_5.5_Software_Architecture.html" title="Apollo 5.5 Software Architecture"
             >下一页</a> |</li>
        <li class="right" >
          <a href="Apollo_3.0_Software_Architecture_cn.html" title="Apollo 3.0 软件架构"
             >上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Apollo 3.5 Software Architecture</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2021, xinetzone.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>