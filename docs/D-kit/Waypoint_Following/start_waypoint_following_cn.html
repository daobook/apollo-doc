
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>循迹搭建–车辆循迹演示 &#8212; Sphinx documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx13.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/translations.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="canonical" href="https://www.sphinx-doc.org/en/master/docs/D-kit/Waypoint_Following/start_waypoint_following_cn.html" />
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Sphinx documentation 中搜索"
          href="../../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../../_static/favicon.svg"/>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="循迹搭建–车辆动力学云标定" href="vehicle_calibration_online_cn.html" />
    <link rel="prev" title="循迹搭建–Apollo系统重装" href="reinstall_my_apollo_system_cn.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script>
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../../../README.html">Home</a></li>
    <li><a href="../../quickstart/README.html">Get it</a></li>
    <li><a href="../../../contents.html">Docs</a></li>
    <li><a href="../../../development/index.html">Extend</a></li>
  </ul>
  <div>
    <a href="../../../README.html">
      <img src="../../../_static/sphinx.png" alt="Apollo Doc" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="vehicle_calibration_online_cn.html" title="循迹搭建–车辆动力学云标定"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="reinstall_my_apollo_system_cn.html" title="循迹搭建–Apollo系统重装"
             accesskey="P">上一页</a> |</li>
        <li><a href="../../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">循迹搭建–车辆循迹演示</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../contents.html">目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">循迹搭建–车辆循迹演示</a><ul>
<li><a class="reference internal" href="#id2">概览</a></li>
<li><a class="reference internal" href="#id3">前提条件</a></li>
<li><a class="reference internal" href="#id4">车辆配置文件准备</a></li>
<li><a class="reference internal" href="#id5">循迹启动</a><ul>
<li><a class="reference internal" href="#can">1. 启动can卡</a></li>
<li><a class="reference internal" href="#dreamview">2. 编译项目，启动Dreamview</a></li>
<li><a class="reference internal" href="#id6">3. 启动所需模块</a></li>
<li><a class="reference internal" href="#id7">4. 检查各模块数据是否正确</a></li>
<li><a class="reference internal" href="#id8">5. 循迹录制</a></li>
<li><a class="reference internal" href="#id9">6. 循迹回放</a></li>
<li><a class="reference internal" href="#id10">7. 再次循迹</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11">调试</a><ul>
<li><a class="reference internal" href="#id12">1. 底盘连接是否正常</a></li>
<li><a class="reference internal" href="#canbus-teleop">2. canbus_teleop的使用</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13">常见问题</a><ul>
<li><a class="reference internal" href="#docker">1. 网络断开或者网络太差无法进入docker</a></li>
<li><a class="reference internal" href="#id14">2. 无法控制汽车底盘和读取底盘信号</a></li>
<li><a class="reference internal" href="#teleop">3. Teleop进入不了自动驾驶模式</a></li>
<li><a class="reference internal" href="#chassis-detail">4. chassis_detail不显示</a></li>
<li><a class="reference internal" href="#apollo">5. apollo系统第一次搭建完毕，测试发转角车辆实际转角不对</a></li>
<li><a class="reference internal" href="#start-auto">6.循迹回放中，点击<code class="docutils literal notranslate"><span class="pre">Start</span> <span class="pre">Auto</span></code>开始后，车辆不动</a></li>
<li><a class="reference internal" href="#id15">7.循迹刹车地点不准确，或者刹车停不下来</a></li>
<li><a class="reference internal" href="#id16">8.循迹效果不佳</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="reinstall_my_apollo_system_cn.html"
                        title="上一章">循迹搭建–Apollo系统重装</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="vehicle_calibration_online_cn.html"
                        title="下一章">循迹搭建–车辆动力学云标定</a></p>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/docs/D-kit/Waypoint_Following/start_waypoint_following_cn.md.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>循迹搭建–车辆循迹演示<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="#%E5%BE%AA%E8%BF%B9%E6%90%AD%E5%BB%BA--%E8%BD%A6%E8%BE%86%E5%BE%AA%E8%BF%B9%E6%BC%94%E7%A4%BA">循迹搭建–车辆循迹演示</a></p>
<ul>
<li><p><a class="reference external" href="#%E6%A6%82%E8%A7%88">概览</a></p></li>
<li><p><a class="reference external" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6">前提条件</a></p></li>
<li><p><a class="reference external" href="#%E8%BD%A6%E8%BE%86%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%87%86%E5%A4%87">车辆配置文件准备</a></p></li>
<li><p><a class="reference external" href="#%E5%BE%AA%E8%BF%B9%E5%90%AF%E5%8A%A8">循迹启动</a></p>
<ul>
<li><p><a class="reference external" href="#1-%E5%90%AF%E5%8A%A8can%E5%8D%A1">1. 启动can卡</a></p></li>
<li><p><a class="reference external" href="#2-%E7%BC%96%E8%AF%91%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8dreamview">2. 编译项目，启动Dreamview</a></p></li>
<li><p><a class="reference external" href="#3-%E5%90%AF%E5%8A%A8%E6%89%80%E9%9C%80%E6%A8%A1%E5%9D%97">3. 启动所需模块</a></p></li>
<li><p><a class="reference external" href="#4-%E6%A3%80%E6%9F%A5%E5%90%84%E6%A8%A1%E5%9D%97%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE">4. 检查各模块数据是否正确</a></p></li>
<li><p><a class="reference external" href="#5-%E5%BE%AA%E8%BF%B9%E5%BD%95%E5%88%B6">5. 循迹录制</a></p></li>
<li><p><a class="reference external" href="#6-%E5%BE%AA%E8%BF%B9%E5%9B%9E%E6%94%BE">6. 循迹回放</a></p></li>
<li><p><a class="reference external" href="#7-%E5%86%8D%E6%AC%A1%E5%BE%AA%E8%BF%B9">7. 再次循迹</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#%E8%B0%83%E8%AF%95">调试</a></p>
<ul>
<li><p><a class="reference external" href="#1-%E5%BA%95%E7%9B%98%E8%BF%9E%E6%8E%A5%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8">1. 底盘连接是否正常</a></p></li>
<li><p><a class="reference external" href="#2-canbus_teleop%E7%9A%84%E4%BD%BF%E7%94%A8">2. canbus_teleop的使用</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">常见问题</a></p>
<ul>
<li><p><a class="reference external" href="#1-%E7%BD%91%E7%BB%9C%E6%96%AD%E5%BC%80%E6%88%96%E8%80%85%E7%BD%91%E7%BB%9C%E5%A4%AA%E5%B7%AE%E6%97%A0%E6%B3%95%E8%BF%9B%E5%85%A5docker">1. 网络断开或者网络太差无法进入docker</a></p></li>
<li><p><a class="reference external" href="#2-%E6%97%A0%E6%B3%95%E6%8E%A7%E5%88%B6%E6%B1%BD%E8%BD%A6%E5%BA%95%E7%9B%98%E5%92%8C%E8%AF%BB%E5%8F%96%E5%BA%95%E7%9B%98%E4%BF%A1%E5%8F%B7">2. 无法控制汽车底盘和读取底盘信号</a></p></li>
<li><p><a class="reference external" href="#3-teleop%E8%BF%9B%E5%85%A5%E4%B8%8D%E4%BA%86%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6%E6%A8%A1%E5%BC%8F">3. Teleop进入不了自动驾驶模式</a></p></li>
<li><p><a class="reference external" href="#4-chassis_detail%E4%B8%8D%E6%98%BE%E7%A4%BA">4. chassis_detail不显示</a></p></li>
<li><p><a class="reference external" href="#5-apollo%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%90%AD%E5%BB%BA%E5%AE%8C%E6%AF%95%E6%B5%8B%E8%AF%95%E5%8F%91%E8%BD%AC%E8%A7%92%E8%BD%A6%E8%BE%86%E5%AE%9E%E9%99%85%E8%BD%AC%E8%A7%92%E4%B8%8D%E5%AF%B9">5. apollo系统第一次搭建完毕，测试发转角车辆实际转角不对</a></p></li>
<li><p><a class="reference external" href="#6%E5%BE%AA%E8%BF%B9%E5%9B%9E%E6%94%BE%E4%B8%AD%E7%82%B9%E5%87%BBstart-auto%E5%BC%80%E5%A7%8B%E5%90%8E%E8%BD%A6%E8%BE%86%E4%B8%8D%E5%8A%A8">6.循迹回放中，点击<code class="docutils literal notranslate"><span class="pre">Start</span> <span class="pre">Auto</span></code>开始后，车辆不动</a></p></li>
<li><p><a class="reference external" href="#7%E5%BE%AA%E8%BF%B9%E5%88%B9%E8%BD%A6%E5%9C%B0%E7%82%B9%E4%B8%8D%E5%87%86%E7%A1%AE%E6%88%96%E8%80%85%E5%88%B9%E8%BD%A6%E5%81%9C%E4%B8%8D%E4%B8%8B%E6%9D%A5">7.循迹刹车地点不准确，或者刹车停不下来</a></p></li>
<li><p><a class="reference external" href="#8%E5%BE%AA%E8%BF%B9%E6%95%88%E6%9E%9C%E4%B8%8D%E4%BD%B3">8.循迹效果不佳</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<section id="id2">
<h2>概览<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>该用户手册旨在帮助用户在开发套件上实现循迹功能。</p></li>
<li><p>循迹作为自动驾驶的最小闭环子集，在硬件上需要搭建自动驾驶最小系统的集成，在软件上实现相关模块的配置、标定、启动等工作，才能进行循迹的操作演示。在循迹过程中，既考验开发者在前述准备工作的掌握程度，又能够很直观的感受到自动驾驶的使用体验。</p></li>
</ul>
</section>
<section id="id3">
<h2>前提条件<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<ol class="simple">
<li><p>在进行车辆循迹前，需要完成以下前提工作：</p></li>
</ol>
<ul class="simple">
<li><p><a class="reference internal" href="vehicle_integration_cn.html"><span class="doc std std-doc">循迹搭建–车辆集成</span></a></p></li>
<li><p><a class="reference internal" href="apollo_installation_cn.html"><span class="doc std std-doc">循迹搭建–Apollo系统安装</span></a></p></li>
<li><p><a class="reference internal" href="localization_configuration_cn.html"><span class="doc std std-doc">循迹搭建–定位模块配置</span></a></p></li>
<li><p><a class="reference internal" href="vehicle_calibration_online_cn.html"><span class="doc std std-doc">循迹搭建–车辆动力学云标定</span></a></p></li>
</ul>
<ol class="simple">
<li><p>确保在开阔场地、车少人少等相对安全的情况下实验。</p></li>
<li><p>确保至少两人操作，一人操作工控机，一人操作遥控器，做好随时接管准备。</p></li>
</ol>
</section>
<section id="id4">
<h2>车辆配置文件准备<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>在<code class="docutils literal notranslate"><span class="pre">/apollo/modules/calibration/data/</span></code>目录下列出了Apollo支持车型的配置参数。</p></li>
<li><p>在<code class="docutils literal notranslate"><span class="pre">/apollo/modules/calibration/data/</span></code>文件夹下，我们为开发套件提供了默认的参数，请务必按照前述<strong>前提条件</strong>的步骤进行配置，否则会导致循迹启动失败。在完成前提条件准备工作后，下面开始启动循迹操作。</p></li>
</ul>
</section>
<section id="id5">
<h2>循迹启动<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<section id="can">
<h3>1. 启动can卡<a class="headerlink" href="#can" title="永久链接至标题">¶</a></h3>
<p>启动工控机后，首先进入CAN卡目录启动CAN驱动，在桌面上打开命令行终端（<code class="docutils literal notranslate"><span class="pre">Terminal</span></code>），操作如下命令</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ~/SocketCan/
bash start.sh
</pre></div>
</div>
<p>正确操作后，会返回如下显示，证明CAN驱动启动成功：</p>
<p><img alt="dev_kit_config" src="../../../_images/start_socketcan.png" /></p>
</section>
<section id="dreamview">
<h3>2. 编译项目，启动Dreamview<a class="headerlink" href="#dreamview" title="永久链接至标题">¶</a></h3>
<p>进入docker环境，用gpu编译项目，启动DreamView</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd /apollo
bash docker/scripts/dev_start.sh
bash docker/scripts/dev_into.sh
bash apollo.sh build_opt_gpu
bash scripts/bootstrap.sh
</pre></div>
</div>
</section>
<section id="id6">
<h3>3. 启动所需模块<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
<p>在浏览器中打开<code class="docutils literal notranslate"><span class="pre">(http://localhost:8888)</span></code>，在<code class="docutils literal notranslate"><span class="pre">--setup</span> <span class="pre">mode--</span></code>内，选择模式为<code class="docutils literal notranslate"><span class="pre">Rtk</span></code>， 在<code class="docutils literal notranslate"><span class="pre">--vehicle--</span></code>选择车型，根据车辆铭牌信息选择对应的车型(见下表)，如使用Apollo D-KIT Lite，则在<code class="docutils literal notranslate"><span class="pre">--vehicle--</span></code>选择车型<code class="docutils literal notranslate"><span class="pre">Dev</span> <span class="pre">Kit</span></code>。</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>铭牌信息</p></th>
<th class="head"><p>选择车型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Apollo D-KIT Lite</p></td>
<td><p>dev_kit</p></td>
</tr>
<tr class="row-odd"><td><p>Apollo D-KIT Standard</p></td>
<td><p>dev_kit_standard</p></td>
</tr>
<tr class="row-even"><td><p>Apollo D-KIT Advanced(NE-B)</p></td>
<td><p>dev_kit_advanced_ne-b</p></td>
</tr>
<tr class="row-odd"><td><p>Apollo D-KIT Advanced(NE-S)</p></td>
<td><p>dev_kit_advanced_ne-s</p></td>
</tr>
<tr class="row-even"><td><p>Apollo D-KIT Advanced(SNE-R)</p></td>
<td><p>dev_kit_advanced_sne-r</p></td>
</tr>
</tbody>
</table>
<p><img alt="dreamview_select_mode_car_type" src="../../../_images/dreamview_select_mode_car_type1.png" /></p>
<p>在页面左上角处点击<code class="docutils literal notranslate"><span class="pre">Module</span> <span class="pre">Controller</span></code>页面标签，进入到软件模块启动界面，
点击侧启动Canbus模块、GPS模块、Localization模块：</p>
<p><img alt="launch_modules" src="../../../_images/launch_modules.png" /></p>
</section>
<section id="id7">
<h3>4. 检查各模块数据是否正确<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p>在docker中输入<code class="docutils literal notranslate"><span class="pre">cyber_monitor</span></code>命令并检查以下channel（使用<code class="docutils literal notranslate"><span class="pre">上下方向键</span></code>选择channel，使用<code class="docutils literal notranslate"><span class="pre">右方向键</span></code>查看channel详细信息。关于cyber_monitor更详细使用，请参考<a class="reference internal" href="../../cyber/CyberRT_Developer_Tools.html"><span class="doc std std-doc">CyberRT_Developer_Tools</span></a>）：</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>channel_name</p></th>
<th class="head"><p>检查项目</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/apollo/canbus/chassis</span></code></p></td>
<td><p>确保能正常输出数据</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/apollo/canbus/chassis_detail</span></code></p></td>
<td><p>确保能正常输出数据</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/apollo/sensor/gnss/best_pose</span></code></p></td>
<td><p>确保能正常输出数据、<code class="docutils literal notranslate"><span class="pre">sol_type:</span></code> 选项显示为<code class="docutils literal notranslate"><span class="pre">NARROW_INT</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/apollo/localization/pose</span></code></p></td>
<td><p>确保能正常输出数据</p></td>
</tr>
</tbody>
</table>
<p>如下图所示</p>
<p><img alt="check_channels" src="../../../_images/check_channels.png" /></p>
</section>
<section id="id8">
<h3>5. 循迹录制<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>1）在空旷场地内，将车辆遥控至循迹起点，记录此时车辆车头方向和所在位置：</p>
<ul class="simple">
<li><p>将<strong>遥控器</strong>按钮置于<code class="docutils literal notranslate"><span class="pre">手动驾驶模式</span></code>；</p></li>
<li><p>记录此时车辆起点位置；</p></li>
</ul>
<p><strong>注:</strong> 可以在车辆左前轮处画一个十字符号，记录车辆的起点。</p>
<p><img alt="rtk_recorder" src="../../../_images/rtk_recorder.jpg" /></p>
<p>2）启动<code class="docutils literal notranslate"><span class="pre">Rtk_Recorder</span></code>录制循迹数据：</p>
<ul class="simple">
<li><p>在<code class="docutils literal notranslate"><span class="pre">Dreamview</span></code>页面内，在<code class="docutils literal notranslate"><span class="pre">Module</span> <span class="pre">Controller</span></code>，点击<code class="docutils literal notranslate"><span class="pre">RTK</span> <span class="pre">Recorder</span></code>按钮，启动循迹录制，录制循迹数据：</p></li>
</ul>
<p><img alt="lanuch_rtk_recorder" src="../../../_images/lanuch_rtk_recorder.png" /></p>
<ul class="simple">
<li><p>这时使用<strong>遥控器</strong>，遥控车辆<strong>前进</strong>一段轨迹，到达期望的终点，车辆停止后，在<code class="docutils literal notranslate"><span class="pre">Dreamview</span></code>页面点击<code class="docutils literal notranslate"><span class="pre">RTK</span> <span class="pre">Recorder</span></code>按钮，关闭循迹数据录制。</p></li>
<li><p><strong>注意</strong>：请务必在车辆到达终点后快速关闭<code class="docutils literal notranslate"><span class="pre">RTK</span> <span class="pre">Recorder</span></code>按钮，否则可能会导致记录多余无用数据，或者只打开不关闭<code class="docutils literal notranslate"><span class="pre">RTK</span> <span class="pre">Recorder</span></code>按钮，可能会导致后续循迹回放无法进行！</p></li>
</ul>
<p><img alt="stop_rtk_recorder" src="../../../_images/stop_rtk_recorder.png" /></p>
<ul class="simple">
<li><p>结束录制循迹轨迹后，录制的循迹数据在<code class="docutils literal notranslate"><span class="pre">apollo/data/log/garage.csv</span></code>中，文件内包含了车辆的轨迹、速度、加速度、曲率、档位、油门、刹车、转向等信息。</p></li>
</ul>
</section>
<section id="id9">
<h3>6. 循迹回放<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<p>1）将车辆移动至之前循迹录制时标记的起点：</p>
<ul class="simple">
<li><p>注意车辆的<strong>起点位置</strong>和<strong>车头朝向</strong>都尽量与循迹录制时起点保持一致；</p></li>
<li><p><strong>遥控器放权</strong>。</p></li>
</ul>
<p><img alt="rtk_player_start" src="../../../_images/rtk_player.jpg" /></p>
<p>2）启动<code class="docutils literal notranslate"><span class="pre">Rtk_Player</span></code>进行循迹回放：</p>
<ul class="simple">
<li><p>启动<code class="docutils literal notranslate"><span class="pre">control</span></code>模块：在<code class="docutils literal notranslate"><span class="pre">Dreamview</span></code>页面<code class="docutils literal notranslate"><span class="pre">Module</span> <span class="pre">Controller</span></code>标签页内，点击<code class="docutils literal notranslate"><span class="pre">Control</span></code>按钮，启动<code class="docutils literal notranslate"><span class="pre">control</span></code>模块。</p></li>
</ul>
<p><img alt="lanuch_control" src="../../../_images/lanuch_control.png" /></p>
<ul class="simple">
<li><p>点击<code class="docutils literal notranslate"><span class="pre">Rtk</span> <span class="pre">Player</span></code>按钮，启动循迹回放，这时会看到车辆前方出现一条蓝色的轨迹线，这条轨迹线就是刚才循迹录制的那条轨迹线；</p></li>
</ul>
<p><img alt="lanuch_rtk_player" src="../../../_images/lanuch_rtk_player.png" /></p>
<ul class="simple">
<li><p><strong>第一次尝试循迹时</strong>，先检查<code class="docutils literal notranslate"><span class="pre">dreamview</span></code>是否有清晰无毛刺的蓝色规划轨迹，请确认轨迹是否与期望的大致相符，如果相差很大，比如本来录制的是直行，而蓝色轨迹显示的大幅度转弯，此时要小心测试，谨防危险。</p></li>
<li><p>这时<strong>车辆还不会进入自动驾驶</strong>，这一步只是把循迹数据放出来，如果车辆没有前进，则会不断<code class="docutils literal notranslate"><span class="pre">replan</span></code>。</p></li>
</ul>
<p>3）然后在<code class="docutils literal notranslate"><span class="pre">Dreamview</span></code>中<code class="docutils literal notranslate"><span class="pre">Task</span></code>标签内，点击<code class="docutils literal notranslate"><span class="pre">Start</span> <span class="pre">Auto</span></code>，这时候车辆开始启动，可能开始起步比较猛，多注意接管。</p>
<p><img alt="rtk_player_startauto" src="../../../_images/rtk_player_startauto.png" /></p>
<p>4）车辆循迹自动驾驶至终点后，车辆停止，<strong>这时使用遥控器首先接管车辆</strong>，然后在<code class="docutils literal notranslate"><span class="pre">Dreamview</span></code>页面<code class="docutils literal notranslate"><span class="pre">Module</span> <span class="pre">Controller</span></code>标签页内，再次点击<code class="docutils literal notranslate"><span class="pre">Rtk</span> <span class="pre">Player</span></code>按钮关闭循迹回放。</p>
<p><img alt="stop_rtk_player" src="../../../_images/stop_rtk_player.png" /></p>
<p><strong>注意事项</strong>：一定要在宽阔的场地进行测试，确保周围没有人，循迹测试之前做好应急接管准备，有问题随时遥控器接管。不要轻易尝试速度大于4m/s（16km/h）的循迹。</p>
<p>5）记录循迹自动驾驶<code class="docutils literal notranslate"><span class="pre">Record数据包</span></code>，可以在第（3）步开始钱，在<code class="docutils literal notranslate"><span class="pre">Dreamview</span></code>页面<code class="docutils literal notranslate"><span class="pre">Module</span> <span class="pre">Controller</span></code>标签页内，点击<code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Recorder</span></code>按钮，录制循迹自动驾驶的<code class="docutils literal notranslate"><span class="pre">Record数据包</span></code>，车辆循迹结束后，<strong>记得再次点击<code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Recorder</span></code>按钮关闭录制</strong>（<strong>注意</strong>：如果只打开不关闭，可能会导致录制的数据包不完整，造成后续使用该数据包失败！），该数据包可以用于后续在实验室查看循迹数据、回放循迹来使用。</p>
<p><img alt="lanuch_data_recorder" src="../../../_images/lanuch_data_recorder.png" /></p>
<ul class="simple">
<li><p>录制的<code class="docutils literal notranslate"><span class="pre">Record数据包</span></code>存储在<code class="docutils literal notranslate"><span class="pre">/apollo/data/bag</span></code>目录中，每一次的录制数据包会存储在以时间戳命名的文件夹内，（<strong>注意</strong>：数据包会在<code class="docutils literal notranslate"><span class="pre">apollo/data/bag/</span></code>文件夹下生成2个<code class="docutils literal notranslate"><span class="pre">年月日时分秒相似</span></code>的文件夹，分别以<code class="docutils literal notranslate"><span class="pre">年-月-日-时-分-秒</span></code>和<code class="docutils literal notranslate"><span class="pre">年-月-日-时-分-秒_s</span></code>命名，开发者可以不用理会<code class="docutils literal notranslate"><span class="pre">_s</span></code>后缀的文件夹，只需要使用<code class="docutils literal notranslate"><span class="pre">年-月-日-时-分-秒</span></code>文件夹内录制的标定数据即可）。</p></li>
</ul>
</section>
<section id="id10">
<h3>7. 再次循迹<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<p>如果想再次循迹其它轨迹路径，可以重复<strong>步骤5-6</strong>，完成不同轨迹的循迹演示。</p>
</section>
</section>
<section id="id11">
<h2>调试<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<section id="id12">
<h3>1. 底盘连接是否正常<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h3>
<p>硬件连接：确保CAN硬件连接线CAN0和车辆线控底盘连接正常，进入<code class="docutils literal notranslate"><span class="pre">apollo</span> <span class="pre">docker</span></code>环境，输入以下命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">apollo</span><span class="o">/</span><span class="n">scripts</span>
<span class="n">bash</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">sh</span>
<span class="n">bash</span> <span class="n">canbus</span><span class="o">.</span><span class="n">sh</span>  <span class="o">//</span><span class="n">启动canbus模块</span>
<span class="n">cyber_monitor</span>
</pre></div>
</div>
<p>在cyber_monitor界面中应该能看到如下的模块：</p>
<p><img alt="图片" src="../../../_images/cyber_monitor_waypoint.png" /></p>
<p>用键盘上下箭头移动光标选择<code class="docutils literal notranslate"><span class="pre">chassis</span></code>或者<code class="docutils literal notranslate"><span class="pre">chassis_detail</span></code>，选中后按右箭头可以进入查看详细信息，这些信息即是车辆底盘信息，<code class="docutils literal notranslate"><span class="pre">chassis</span></code>消息如下：</p>
<p><img alt="图片" src="../../../_images/chassis.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">chassis</span> <span class="pre">detail</span></code>消息如下：</p>
<p><img alt="图片" src="../../../_images/chassis_detail2.png" /></p>
<p>如果这些信息得到正确显示，说明CANBUS模块工作正常。如果不能显示底盘信息，很大可能是CANBUS有问题，或者底盘有问题，没有向上反馈底盘数据。
保证CANBUS的连接正确性，才能确定工控机计算单元可以控制车辆底盘，才能继续其它部分的调试。</p>
</section>
<section id="canbus-teleop">
<h3>2. canbus_teleop的使用<a class="headerlink" href="#canbus-teleop" title="永久链接至标题">¶</a></h3>
<p>CANBUS能够连接底盘后，我们可以尝试控制底盘的运动。如果控制正常，则说明工控机计算单元下发命令后得到正确执行。 进入Ubuntu Docker环境，输入以下命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">apollo</span><span class="o">/</span><span class="n">scripts</span> 
<span class="n">bash</span> <span class="n">canbus_teleop</span><span class="o">.</span><span class="n">sh</span> 
</pre></div>
</div>
<p>弹出界面如下：</p>
<p><img alt="图片" src="../../../_images/teleop_ui.png" /></p>
<p>a 根据提示按<code class="docutils literal notranslate"><span class="pre">m0</span></code>重置系统，按<code class="docutils literal notranslate"><span class="pre">m1</span></code>是开始控制底盘。
b 按几次<code class="docutils literal notranslate"><span class="pre">a</span></code>或者<code class="docutils literal notranslate"><span class="pre">d</span></code>，看看车轮是否转动。
c 按<code class="docutils literal notranslate"><span class="pre">g1</span></code>，挂前进档，按几次<code class="docutils literal notranslate"><span class="pre">w</span></code>，看车辆是否前进，按几次<code class="docutils literal notranslate"><span class="pre">s</span></code>看车辆是否停下来。
请小心测试，不要轻易长时间连续按键，以防车辆突然高速动作发生事故。</p>
</section>
</section>
<section id="id13">
<h2>常见问题<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h2>
<p>调试过程中，常见的问题及解决办法总结如下：</p>
<section id="docker">
<h3>1. 网络断开或者网络太差无法进入docker<a class="headerlink" href="#docker" title="永久链接至标题">¶</a></h3>
<p>报错如下：</p>
<p><img alt="图片" src="../../../_images/debug_docker.png" /></p>
<p>主要是因为网络没有连接上，或者网络太慢，请检查网路。</p>
<p>可以执行<code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">docker/scripts/dev_start.sh</span> <span class="pre">-n</span></code>，<code class="docutils literal notranslate"><span class="pre">-n</span></code>参数表示不联网下载<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">image</span></code>更新，直接使用本地镜像。</p>
</section>
<section id="id14">
<h3>2. 无法控制汽车底盘和读取底盘信号<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h3>
<p>具体表现是车辆下发油门转向等信号，底盘不执行，也读不到底盘的相关信息，这时候的原因应该是CAN不通。解决方法如下：</p>
<p>1）查看CAN线硬件是否连接合适；</p>
<p>2）如果（1）已经正确，但问题还存在，查看启动canbus前是否在<code class="docutils literal notranslate"><span class="pre">docker</span></code>外是否启动<code class="docutils literal notranslate"><span class="pre">SocketCAN</span></code>启动脚本<code class="docutils literal notranslate"><span class="pre">start.sh</span></code>；</p>
<p>3）如果（2）已经正确，但问题还存在，查看<code class="docutils literal notranslate"><span class="pre">apollo/data/log/canbus.INFO</span></code>是否有报错信息；</p>
<p>4）如果（3）尝试了，仍然没有解决，用CAN调试工具，看底盘是否有信号上报，以及apollo执行的时候，是否有命令下发。</p>
</section>
<section id="teleop">
<h3>3. Teleop进入不了自动驾驶模式<a class="headerlink" href="#teleop" title="永久链接至标题">¶</a></h3>
<p>打开<code class="docutils literal notranslate"><span class="pre">canbus.sh</span></code>后，执行<code class="docutils literal notranslate"><span class="pre">canbus_teleop.sh</span></code>始终无法进入自动驾驶模式，CAN调试工具测量底盘信号是通的。这种情况，有可能是guidian模块打开造成，guidian模块是一种安全保护机制，开发者调试阶段，可以根据需要关掉。
打开<code class="docutils literal notranslate"><span class="pre">/apollo/module/canbus/conf/canbus.conf</span></code>：
修改<code class="docutils literal notranslate"><span class="pre">--receive_guardian</span></code>为<code class="docutils literal notranslate"><span class="pre">--noreceive_guardian</span></code>。</p>
</section>
<section id="chassis-detail">
<h3>4. chassis_detail不显示<a class="headerlink" href="#chassis-detail" title="永久链接至标题">¶</a></h3>
<p>1）查看<code class="docutils literal notranslate"><span class="pre">dreamview</span></code>内否选择了<code class="docutils literal notranslate"><span class="pre">Dev_Kit</span></code>车型，如果不确认可以先选择其它车型后，重新选择<code class="docutils literal notranslate"><span class="pre">Dev_Kit</span></code>；</p>
<p>2）查看canbus配置文件<code class="docutils literal notranslate"><span class="pre">/apollo/module/canbus/conf/canbus.conf</span></code>内是否打开chassis_detail，如没有打开，把<code class="docutils literal notranslate"><span class="pre">--noenable_chassis_detail_pub</span></code>修改为<code class="docutils literal notranslate"><span class="pre">enable_chassis_detail_pub</span></code>，重启<code class="docutils literal notranslate"><span class="pre">canbus</span></code>后生效。</p>
<p>3）是否正确启动CAN驱动，查看启动canbus前是否在<code class="docutils literal notranslate"><span class="pre">docker</span></code>外是否启动<code class="docutils literal notranslate"><span class="pre">SocketCAN</span></code>启动脚本<code class="docutils literal notranslate"><span class="pre">start.sh</span></code>。</p>
<p>4）查看硬件CAN线接口有没有松动。</p>
</section>
<section id="apollo">
<h3>5. apollo系统第一次搭建完毕，测试发转角车辆实际转角不对<a class="headerlink" href="#apollo" title="永久链接至标题">¶</a></h3>
<p>例如下发转向角10%，但是转动角度远超过转向最大角度的10%，可以在cyber_monitor中查看 /apollo/canbus/chassis及时观察底盘信号，apollo默认是Lincoln车型，如果使用者第一次搭建好apollo，还没有选择车型那么默认会按照<code class="docutils literal notranslate"><span class="pre">mkz_example</span></code>车型的最大转向角乘以百分比去执行。解决方法如下：检查modules/canbus/conf/canbus_conf.pb.txt中的配置，brand设置为正确的车型（例如<code class="docutils literal notranslate"><span class="pre">CH</span></code>），重启canbus，再尝试。如何仍然未解决，请运行bootstrap.sh脚本，在dreamview中选择对应的车型，选择<code class="docutils literal notranslate"><span class="pre">Dev</span> <span class="pre">Kit</span></code>开发套件，然后再执行前述步骤检查转角是否正确。</p>
</section>
<section id="start-auto">
<h3>6.循迹回放中，点击<code class="docutils literal notranslate"><span class="pre">Start</span> <span class="pre">Auto</span></code>开始后，车辆不动<a class="headerlink" href="#start-auto" title="永久链接至标题">¶</a></h3>
<p>1）查看遥控器是否放权</p>
</section>
<section id="id15">
<h3>7.循迹刹车地点不准确，或者刹车停不下来<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h3>
<p>很可能是标定没有做好，标定刹车部分没有做好，急刹缓刹都要考虑。</p>
</section>
<section id="id16">
<h3>8.循迹效果不佳<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h3>
<p>纵向效果不好，请考虑标定表和PID参数调整以及车辆本身的信号（例如油门和刹车下发和上报是否一致），横向误差大，主要考虑LQR参数调整和车辆转向信号（下发和上报是否一致）。</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="vehicle_calibration_online_cn.html" title="循迹搭建–车辆动力学云标定"
             >下一页</a> |</li>
        <li class="right" >
          <a href="reinstall_my_apollo_system_cn.html" title="循迹搭建–Apollo系统重装"
             >上一页</a> |</li>
        <li><a href="../../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">循迹搭建–车辆循迹演示</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2021, xinetzone.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>