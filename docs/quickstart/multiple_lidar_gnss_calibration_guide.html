
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Multiple-LiDAR GNSS Calibration Guide &#8212; Sphinx documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx13.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/translations.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="canonical" href="https://www.sphinx-doc.org/en/master/docs/quickstart/multiple_lidar_gnss_calibration_guide.html" />
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Sphinx documentation 中搜索"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.svg"/>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="多激光雷达全球导航卫星系统(Multiple-LiDAR GNSS)校准指南" href="multiple_lidar_gnss_calibration_guide_cn.html" />
    <link rel="prev" title="Apollo Upgraded Hardware and System Installation Guide" href="apollo_updated_hardware_system_installation_guide.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script>
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../../README.html">Home</a></li>
    <li><a href="README.html">Get it</a></li>
    <li><a href="../../contents.html">Docs</a></li>
    <li><a href="../../development/index.html">Extend</a></li>
  </ul>
  <div>
    <a href="../../README.html">
      <img src="../../_static/sphinx.png" alt="Apollo Doc" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="multiple_lidar_gnss_calibration_guide_cn.html" title="多激光雷达全球导航卫星系统(Multiple-LiDAR GNSS)校准指南"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="apollo_updated_hardware_system_installation_guide.html" title="Apollo Upgraded Hardware and System Installation Guide"
             accesskey="P">上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Multiple-LiDAR GNSS Calibration Guide</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">Multiple-LiDAR GNSS Calibration Guide</a><ul>
<li><a class="reference internal" href="#contents">Contents</a></li>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#preparation">Preparation</a></li>
<li><a class="reference internal" href="#using-the-calibration-tool">Using the Calibration Tool</a><ul>
<li><a class="reference internal" href="#record-calibration-data">Record Calibration Data</a></li>
<li><a class="reference internal" href="#export-data">Export Data</a></li>
<li><a class="reference internal" href="#run-the-calibration-tool">Run the Calibration Tool</a></li>
</ul>
</li>
<li><a class="reference internal" href="#results-and-validation">Results and Validation</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="apollo_updated_hardware_system_installation_guide.html"
                        title="上一章">Apollo Upgraded Hardware and System Installation Guide</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="multiple_lidar_gnss_calibration_guide_cn.html"
                        title="下一章">多激光雷达全球导航卫星系统(Multiple-LiDAR GNSS)校准指南</a></p>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/docs/quickstart/multiple_lidar_gnss_calibration_guide.md.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="multiple-lidar-gnss-calibration-guide">
<h1>Multiple-LiDAR GNSS Calibration Guide<a class="headerlink" href="#multiple-lidar-gnss-calibration-guide" title="永久链接至标题">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NOTE</span><span class="p">:</span> <span class="n">Supports</span> <span class="n">upto</span> <span class="n">Apollo</span> <span class="mf">3.0</span><span class="o">.</span> <span class="n">Apollo</span> <span class="mf">3.5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">supported</span> <span class="n">yet</span><span class="o">.</span>
</pre></div>
</div>
<p>Welcome to use the Multiple-LiDAR GNSS calibration tool. This guide will show you the steps to successfully calibrate multiple LiDARs.</p>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>Overview</p></li>
<li><p>Preparation</p></li>
<li><p>Using the Calibration Tool</p></li>
<li><p>Results and Validation</p></li>
</ul>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="永久链接至标题">¶</a></h2>
<p>In many autonomous driving tasks such as HDMap production, the scans from multiple LiDARs need to be registered in a unified coordinate system. In this case, the extrinsic parameters of multiple LiDARs need to be carefully calibrated. This Multiple-LiDAR GNSS calibration tool is developed to solve this problem.</p>
</section>
<section id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="永久链接至标题">¶</a></h2>
<ol class="simple">
<li><p>Download the <a class="reference external" href="https://github.com/ApolloAuto/apollo/releases/download/v2.5.0/multi_lidar_gnss_calibrator_and_doc.zip">calibration tool</a>, and extract files to <code class="docutils literal notranslate"><span class="pre">$APOLLO_HOME/modules/calibration</span></code>. APOLLO_HOME is the root directory of apollo repository.</p></li>
<li><p>Choose a calibration place according to the calibration guide provided in Apollo 1.5.</p></li>
<li><p>Make sure the GNSS is in a good status. To verify this, use <code class="docutils literal notranslate"><span class="pre">rostopic</span> <span class="pre">echo</span> <span class="pre">/apollo/sensor/gnss/best_pose</span></code> and check the number after keywords <code class="docutils literal notranslate"><span class="pre">latitude_std_dev</span></code>, <code class="docutils literal notranslate"><span class="pre">longitude_std_dev</span></code> and <code class="docutils literal notranslate"><span class="pre">height_std_dev</span></code>. The smaller the deviation, the better the calibration quality. *** We strongly recommend calibrating the sensors when deviations are smaller than 0.02.***</p></li>
</ol>
</section>
<section id="using-the-calibration-tool">
<h2>Using the Calibration Tool<a class="headerlink" href="#using-the-calibration-tool" title="永久链接至标题">¶</a></h2>
<section id="record-calibration-data">
<h3>Record Calibration Data<a class="headerlink" href="#record-calibration-data" title="永久链接至标题">¶</a></h3>
<p>When the LiDARs and GNSS are ready, use <code class="docutils literal notranslate"><span class="pre">/apollo/modules/calibration/multi_lidar_gnss/record.sh</span></code> to record calibration data. Note that, this script is only for recording  velodyne HDL64 and VLP16. For other purpose, some modification of this script is needed or just use rosbag record to do the same thing. Usually, 2 minites length of data is sufficient. After data capture, run <code class="docutils literal notranslate"><span class="pre">/apollo/modules/calibration/multi_lidar_gnss/calibrate.sh</span></code> to calibrate sensors. The script is composed of the following two steps.</p>
</section>
<section id="export-data">
<h3>Export Data<a class="headerlink" href="#export-data" title="永久链接至标题">¶</a></h3>
<p>Once the calibration bag is recorded, use <code class="docutils literal notranslate"><span class="pre">/apollo/modules/calibration/exporter/export_msgs</span> <span class="pre">--config</span> <span class="pre">/apollo/modules/calibration/exporter/conf/export_config.yaml</span></code> to get sensor data. The only input of the exporter is a YAML configuration file as follow.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bag_path: <span class="s2">&quot;/apollo/data/bag/calibration/&quot;</span> <span class="c1"># The path where the calibration bag is placed.</span>
dump_dir: <span class="s2">&quot;/apollo/data/bag/calibration/export/&quot;</span> <span class="c1"># The path where the sensor data will be placed using exporter</span>
topics:
    - /apollo/sensor/gnss/odometry: <span class="c1"># Odometry topic name</span>
        type: ApolloOdometry        <span class="c1"># Odometry type</span>
    - /apollo/sensor/velodyne16/PointCloud2: <span class="c1"># vlp16 topic name</span>
        type: PointCloud2                    <span class="c1"># vlp16 type</span>
    - /apollo/sensor/velodyne64/PointCloud2: <span class="c1"># hdl64 topic name</span>
        type: PointCloud2                    <span class="c1"># hdl64 type</span>
</pre></div>
</div>
<p>Other topics of PointCloud2 type also can be exported, if new topics are added to the file in the rule as follow.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>    - TOPIC_NAME: <span class="c1"># topic name</span>
        type: PointCloud2
</pre></div>
</div>
<p>Till now, we only support <code class="docutils literal notranslate"><span class="pre">ApolloOdometry</span></code> and <code class="docutils literal notranslate"><span class="pre">PointCloud2</span></code>.</p>
</section>
<section id="run-the-calibration-tool">
<h3>Run the Calibration Tool<a class="headerlink" href="#run-the-calibration-tool" title="永久链接至标题">¶</a></h3>
<p>If all sensor data are exported, run <code class="docutils literal notranslate"><span class="pre">/apollo/modules/calibration/lidar_gnss_calibrator/multi_lidar_gnss_calibrator</span> <span class="pre">--config</span> <span class="pre">/apollo/modules/calibration/lidar_gnss_calibrator/conf/multi_lidar_gnss_calibrator_config.yaml</span></code> will get the results. The input of the tool is a YAML configuration file as follow.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># multi-LiDAR-GNSS calibration configurations</span>
data:
    odometry: <span class="s2">&quot;/apollo/data/bag/calibration/export/multi_lidar_gnss/_apollo_sensor_gnss_odometry/odometry&quot;</span>
    lidars: 
        - velodyne16: 
            path: <span class="s2">&quot;/apollo/data/bag/calibration/export/multi_lidar_gnss/_apollo_sensor_velodyne16_PointCloud2/&quot;</span>
        - velodyne64: 
            path: <span class="s2">&quot;/apollo/data/bag/calibration/export/multi_lidar_gnss/_apollo_sensor_velodyne64_PointCloud2/&quot;</span>
    result: <span class="s2">&quot;/apollo/data/bag/calibration/export/multi_lidar_gnss/result/&quot;</span>
calibration:
    init_extrinsics:
        velodyne16:
            translation:    
                x: <span class="m">0</span>.0
                y: <span class="m">1</span>.77 
                z: <span class="m">1</span>.1
            rotation:
                x: <span class="m">0</span>.183014 
                y: -0.183014 
                z: <span class="m">0</span>.683008 
                w: <span class="m">0</span>.683008
        velodyne64:
            translation:    
                x: <span class="m">0</span>.0
                y: <span class="m">1</span>.57
                z: <span class="m">1</span>.3
            rotation:
                x: <span class="m">0</span>.0
                y: <span class="m">0</span>.0
                z: <span class="m">0</span>.707
                w: <span class="m">0</span>.707
    steps: 
        - source_lidars: <span class="o">[</span><span class="s2">&quot;velodyne64&quot;</span><span class="o">]</span>
          target_lidars: <span class="o">[</span><span class="s2">&quot;velodyne64&quot;</span><span class="o">]</span>
          lidar_type: <span class="s2">&quot;multiple&quot;</span>
          fix_target_lidars: <span class="nb">false</span>
          fix_z: <span class="nb">true</span>
          iteration: <span class="m">3</span>
        - source_lidars: <span class="o">[</span><span class="s2">&quot;velodyne16&quot;</span><span class="o">]</span>
          target_lidars: <span class="o">[</span><span class="s2">&quot;velodyne16&quot;</span><span class="o">]</span>
          lidar_type: <span class="s2">&quot;multiple&quot;</span>
          fix_target_lidars: <span class="nb">false</span>
          fix_z: <span class="nb">true</span>
          iteration: <span class="m">3</span>
        - source_lidars: <span class="o">[</span><span class="s2">&quot;velodyne16&quot;</span><span class="o">]</span>
          target_lidars: <span class="o">[</span><span class="s2">&quot;velodyne64&quot;</span><span class="o">]</span>
          lidar_type: <span class="s2">&quot;multiple&quot;</span>
          fix_target_lidars: <span class="nb">true</span>
          fix_z: <span class="nb">false</span>
          iteration: <span class="m">3</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">data</span></code> section tells the tool where to get point clouds and odometry file, and also where to save the results. Note that, the keywords in <code class="docutils literal notranslate"><span class="pre">lidar</span></code> node will be recognized as frame id for the LiDARs.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">calibration</span></code> section provides initial guess of the extrinsics. <em><strong>All extrinsics are from LiDAR to GNSS</strong></em>, which means this transformation maps the coordinates of a point defined in the LiDAR coordinate system to the coordinates of this point defined in the GNSS coordinate system. The initial guess requires the rotation angle error less than 5 degrees, and the translation error less than 0.1 meter.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">steps</span></code> section specifies the calibration procedure. Each step is defined as follow and their meanings are in comments.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>- source_lidars: <span class="o">[</span><span class="s2">&quot;velodyne16&quot;</span><span class="o">]</span> <span class="c1"># Source LiDAR in point cloud registration.</span>
  target_lidars: <span class="o">[</span><span class="s2">&quot;velodyne64&quot;</span><span class="o">]</span> <span class="c1"># Target LiDAR in point cloud registration.</span>
  lidar_type: <span class="s2">&quot;multiple&quot;</span> <span class="c1"># &quot;multiple&quot; for multi-beam LiDAR, otherwise &quot;single&quot;</span>
  fix_target_lidars: <span class="nb">true</span> <span class="c1"># Whether to fix  extrinsics of target LiDARS. Only &quot;true&quot; when align different LiDARs.</span>
  fix_z: <span class="nb">false</span> <span class="c1"># Whether to fix the z component of translation. Only &quot;false&quot; when align different LiDARs.</span>
  iteration: <span class="m">3</span> <span class="c1"># Iteration number</span>
</pre></div>
</div>
</section>
</section>
<section id="results-and-validation">
<h2>Results and Validation<a class="headerlink" href="#results-and-validation" title="永久链接至标题">¶</a></h2>
<p>The calibration tool saves the results to <code class="docutils literal notranslate"><span class="pre">result</span></code> path as follow.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>.
└── calib_result
    ├── velodyne16_novatel_extrinsics.yaml
    ├── velodyne16_result.pcd
    ├── velodyne16_result_rgb.pcd
    ├── velodyne64_novatel_extrinsics.yaml
    ├── velodyne64_result.pcd
    └── velodyne64_result_rgb.pcd
</pre></div>
</div>
<p>The two YAML files are extrinsics. To validate the results, use <code class="docutils literal notranslate"><span class="pre">pcl_viewer</span> <span class="pre">*_result.pcd</span></code> to check the registration quality. If the sensors are well calibrated, a large amount of details can be identified from the point cloud. For more details, please refer to the calibration guide in Apollo 1.5.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="multiple_lidar_gnss_calibration_guide_cn.html" title="多激光雷达全球导航卫星系统(Multiple-LiDAR GNSS)校准指南"
             >下一页</a> |</li>
        <li class="right" >
          <a href="apollo_updated_hardware_system_installation_guide.html" title="Apollo Upgraded Hardware and System Installation Guide"
             >上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Multiple-LiDAR GNSS Calibration Guide</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2021, xinetzone.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>