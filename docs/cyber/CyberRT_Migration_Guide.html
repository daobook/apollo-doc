
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Migration guide from Apollo ROS &#8212; Sphinx documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx13.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/translations.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="canonical" href="https://www.sphinx-doc.org/en/master/docs/cyber/CyberRT_Migration_Guide.html" />
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Sphinx documentation 中搜索"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.svg"/>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="erer" href="CyberRT_Python_API.html" />
    <link rel="prev" title="Apollo Cyber RT FAQs" href="CyberRT_FAQs.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script>
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../../README.html">Home</a></li>
    <li><a href="../quickstart/README.html">Get it</a></li>
    <li><a href="../../contents.html">Docs</a></li>
    <li><a href="../../development/index.html">Extend</a></li>
  </ul>
  <div>
    <a href="../../README.html">
      <img src="../../_static/sphinx.png" alt="Apollo Doc" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="CyberRT_Python_API.html" title="erer"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="CyberRT_FAQs.html" title="Apollo Cyber RT FAQs"
             accesskey="P">上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Migration guide from Apollo ROS</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">Migration guide from Apollo ROS</a><ul>
<li><a class="reference internal" href="#build-system">Build system</a><ul>
<li><a class="reference internal" href="#proto">Proto</a></li>
</ul>
</li>
<li><a class="reference internal" href="#folder-structure">Folder structure</a><ul>
<li><a class="reference internal" href="#apollo-ros">Apollo ROS</a></li>
<li><a class="reference internal" href="#cyber-rt">Cyber RT</a></li>
</ul>
</li>
<li><a class="reference internal" href="#update-source-code">Update source code</a><ul>
<li><a class="reference internal" href="#listener">Listener</a></li>
<li><a class="reference internal" href="#talker">Talker</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tools-mapping">Tools mapping</a></li>
<li><a class="reference internal" href="#ros-bag-data-migration">ROS bag data migration</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="CyberRT_FAQs.html"
                        title="上一章">Apollo Cyber RT FAQs</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="CyberRT_Python_API.html"
                        title="下一章">erer</a></p>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/docs/cyber/CyberRT_Migration_Guide.md.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="migration-guide-from-apollo-ros">
<h1>Migration guide from Apollo ROS<a class="headerlink" href="#migration-guide-from-apollo-ros" title="永久链接至标题">¶</a></h1>
<p>This article describes the essential changes for projects to migrate from Apollo ROS (Apollo 3.0 and before) to Apollo Cyber RT (Apollo 3.5 and after). We will be using the very first ROS project talker/listener as example to demonstrate step by step migration instruction.</p>
<section id="build-system">
<h2>Build system<a class="headerlink" href="#build-system" title="永久链接至标题">¶</a></h2>
<p>ROS use <code class="docutils literal notranslate"><span class="pre">CMake</span></code> as its build system but Cyber RT use <code class="docutils literal notranslate"><span class="pre">bazel</span></code>. In a ROS project, CmakeLists.txt and package.xml are required for defining build configs like build target, dependency, message files and so on. As for a Cyber RT component, a single bazel BUILD file covers. Some key build config mappings are listed below.</p>
<p>Cmake</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">project</span><span class="p">(</span><span class="s">pb_msgs_example</span><span class="p">)</span>
<span class="nb">add_proto_files</span><span class="p">(</span>
  <span class="s">DIRECTORY</span> <span class="s">proto</span>
  <span class="s">FILES</span> <span class="s">chatter.proto</span>
<span class="p">)</span>
<span class="c">## Declare a C++ executable</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">pb_talker</span> <span class="s">src/talker.cpp</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">pb_talker</span> <span class="o">${</span><span class="nv">catkin_LIBRARIES</span><span class="o">}</span><span class="s">pb_msgs_example_proto</span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">pb_listener</span> <span class="s">src/listener.cpp</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">pb_listener</span> <span class="o">${</span><span class="nv">catkin_LIBRARIES</span><span class="o">}</span>  <span class="s">pb_msgs_example_proto</span><span class="p">)</span>
</pre></div>
</div>
<p>Bazel</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cc_binary</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;talker&quot;</span><span class="p">,</span>
  <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;talker.cc&quot;</span><span class="p">],</span>
  <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;//cyber&quot;</span><span class="p">,</span>
    <span class="s2">&quot;//cyber/examples/proto:examples_cc_proto&quot;</span><span class="p">,</span>
    <span class="p">],</span>
  <span class="p">)</span>
<span class="n">cc_binary</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;listener&quot;</span><span class="p">,</span>
  <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;listener.cc&quot;</span><span class="p">],</span>
  <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;//cyber&quot;</span><span class="p">,</span>
    <span class="s2">&quot;//cyber/examples/proto:examples_cc_proto&quot;</span><span class="p">,</span>
    <span class="p">],</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>We can find the mapping easily from the 2 file snippets. For example, <code class="docutils literal notranslate"><span class="pre">pb_talker</span></code> and <code class="docutils literal notranslate"><span class="pre">src/talker.cpp</span></code> in cmake <code class="docutils literal notranslate"><span class="pre">add_executable</span></code> setting map to <code class="docutils literal notranslate"><span class="pre">name</span> <span class="pre">=</span> <span class="pre">&quot;talker&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">srcs</span> <span class="pre">=</span> <span class="pre">[&quot;talker.cc&quot;]</span></code> in BUILD file <code class="docutils literal notranslate"><span class="pre">cc_binary</span></code>.</p>
<section id="proto">
<h3>Proto<a class="headerlink" href="#proto" title="永久链接至标题">¶</a></h3>
<p>Apollo ROS has customized to support proto message formate that a separate section <code class="docutils literal notranslate"><span class="pre">add_proto_files</span></code> and projectName_proto(<code class="docutils literal notranslate"><span class="pre">pb_msgs_example_proto</span></code>) in <code class="docutils literal notranslate"><span class="pre">target_link_libraries</span></code> are required to send message in proto formate. For config proto message in Cyber RT, it’s as simple as adding the target proto file path concantenated with name of <code class="docutils literal notranslate"><span class="pre">cc_proto_library</span></code> in <code class="docutils literal notranslate"><span class="pre">deps</span></code> setting. The <code class="docutils literal notranslate"><span class="pre">cc_proto_library</span></code> is set up in BUILD file under proto folder.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cc_proto_library</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;examples_cc_proto&quot;</span><span class="p">,</span>
  <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;:examples_proto&quot;</span><span class="p">,</span>
  <span class="p">],</span>
<span class="p">)</span>
<span class="n">proto_library</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;examples_proto&quot;</span><span class="p">,</span>
  <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;examples.proto&quot;</span><span class="p">,</span>
  <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The package definition has also changed in Cyber RT. In Apollo ROS a fixed package <code class="docutils literal notranslate"><span class="pre">package</span> <span class="pre">pb_msgs;</span></code> is used for proto files, but in Cyber RT, the proto file path <code class="docutils literal notranslate"><span class="pre">package</span> <span class="pre">apollo.cyber.examples.proto;</span></code> is used instead.</p>
</section>
</section>
<section id="folder-structure">
<h2>Folder structure<a class="headerlink" href="#folder-structure" title="永久链接至标题">¶</a></h2>
<p>As shown below, Cyber RT remove the src folder and pull all source code in the same folder as BUILD file. BUILD file plays the same role as CMakeLists.txt plus package.xml. Both Cyber RT and Apollo ROS talker/listener example have a proto folder for message proto files but Cyber RT requires a separate BUILD file for proto folder to set up the proto library.</p>
<section id="apollo-ros">
<h3>Apollo ROS<a class="headerlink" href="#apollo-ros" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>CMakeLists.txt</p></li>
<li><p>package.xml</p></li>
<li><p>proto</p>
<ul>
<li><p>chatter.proto</p></li>
</ul>
</li>
<li><p>src</p>
<ul>
<li><p>listener.cpp</p></li>
<li><p>talker.cpp</p></li>
</ul>
</li>
</ul>
</section>
<section id="cyber-rt">
<h3>Cyber RT<a class="headerlink" href="#cyber-rt" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>BUILD</p></li>
<li><p><a class="reference external" href="http://listener.cc">listener.cc</a></p></li>
<li><p><a class="reference external" href="http://talker.cc">talker.cc</a></p></li>
<li><p>proto</p>
<ul>
<li><p>BUILD</p></li>
<li><p>examples.proto (with chatter message)</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="update-source-code">
<h2>Update source code<a class="headerlink" href="#update-source-code" title="永久链接至标题">¶</a></h2>
<section id="listener">
<h3>Listener<a class="headerlink" href="#listener" title="永久链接至标题">¶</a></h3>
<p>Cyber RT</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;cyber/cyber.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;cyber/examples/proto/examples.pb.h&quot;</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">MessageCallback</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">apollo</span><span class="o">::</span><span class="n">cyber</span><span class="o">::</span><span class="n">examples</span><span class="o">::</span><span class="n">proto</span><span class="o">::</span><span class="n">Chatter</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">AINFO</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Received message seq-&gt; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">seq</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="n">AINFO</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;msgcontent-&gt;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">content</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// init cyber framework</span>
<span class="w">  </span><span class="n">apollo</span><span class="o">::</span><span class="n">cyber</span><span class="o">::</span><span class="n">Init</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">  </span><span class="c1">// create listener node</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">listener_node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apollo</span><span class="o">::</span><span class="n">cyber</span><span class="o">::</span><span class="n">CreateNode</span><span class="p">(</span><span class="s">&quot;listener&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="c1">// create listener</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">listener</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="n">listener_node</span><span class="o">-&gt;</span><span class="n">CreateReader</span><span class="o">&lt;</span><span class="n">apollo</span><span class="o">::</span><span class="n">cyber</span><span class="o">::</span><span class="n">examples</span><span class="o">::</span><span class="n">proto</span><span class="o">::</span><span class="n">Chatter</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">          </span><span class="s">&quot;channel/chatter&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MessageCallback</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">apollo</span><span class="o">::</span><span class="n">cyber</span><span class="o">::</span><span class="n">WaitForShutdown</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>ROS</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ros/ros.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;chatter.pb.h&quot;</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">MessageCallback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">pb_msgs</span><span class="o">::</span><span class="n">Chatter</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">ROS_INFO_STREAM</span><span class="p">(</span><span class="s">&quot;Time: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">stamp</span><span class="p">().</span><span class="n">sec</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">stamp</span><span class="p">().</span><span class="n">nsec</span><span class="p">());</span><span class="w"></span>
<span class="w">  </span><span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;I heard pb Chatter message: [%s]&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">content</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;listener&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">pb_sub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;chatter&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="n">MessageCallback</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">ros</span><span class="o">::</span><span class="n">spin</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>You can see easily from the two listener code above that Cyber RT provides very similar API to for developers to migrate from ROS.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ros::init(argc,</span> <span class="pre">argv,</span> <span class="pre">&quot;listener&quot;);</span></code> –&gt; <code class="docutils literal notranslate"><span class="pre">apollo::cyber::Init(argv[0]);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ros::NodeHandle</span> <span class="pre">n;</span></code> –&gt; <code class="docutils literal notranslate"><span class="pre">auto</span> <span class="pre">listener_node</span> <span class="pre">=</span> <span class="pre">apollo::cyber::CreateNode(&quot;listener&quot;);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ros::Subscriber</span> <span class="pre">pb_sub</span> <span class="pre">=</span> <span class="pre">n.subscribe(&quot;chatter&quot;,</span> <span class="pre">1000,</span> <span class="pre">MessageCallback);</span></code> –&gt; <code class="docutils literal notranslate"><span class="pre">auto</span> <span class="pre">listener</span> <span class="pre">=</span>&#160;&#160;&#160;&#160; <span class="pre">listener_node-&gt;CreateReader(&quot;channel/chatter&quot;,</span> <span class="pre">MessageCallback);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ros::spin();</span></code> –&gt; <code class="docutils literal notranslate"><span class="pre">apollo::cyber::WaitForShutdown();</span></code></p></li>
</ul>
<p>Note: for Cyber RT, a listener node has to use <code class="docutils literal notranslate"><span class="pre">node-&gt;CreateReader&lt;messageType&gt;(channelName,</span> <span class="pre">callback)</span></code> to read data from channel.</p>
</section>
<section id="talker">
<h3>Talker<a class="headerlink" href="#talker" title="永久链接至标题">¶</a></h3>
<p>Cyber RT</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;cyber/cyber.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;cyber/examples/proto/examples.pb.h&quot;</span><span class="cp"></span>

<span class="k">using</span><span class="w"> </span><span class="n">apollo</span><span class="o">::</span><span class="n">cyber</span><span class="o">::</span><span class="n">examples</span><span class="o">::</span><span class="n">proto</span><span class="o">::</span><span class="n">Chatter</span><span class="p">;</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// init cyber framework</span>
<span class="w">  </span><span class="n">apollo</span><span class="o">::</span><span class="n">cyber</span><span class="o">::</span><span class="n">Init</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">  </span><span class="c1">// create talker node</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">talker_node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apollo</span><span class="o">::</span><span class="n">cyber</span><span class="o">::</span><span class="n">CreateNode</span><span class="p">(</span><span class="s">&quot;talker&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="c1">// create talker</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">talker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">talker_node</span><span class="o">-&gt;</span><span class="n">CreateWriter</span><span class="o">&lt;</span><span class="n">Chatter</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;channel/chatter&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">Rate</span><span class="w"> </span><span class="n">rate</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">apollo</span><span class="o">::</span><span class="n">cyber</span><span class="o">::</span><span class="n">OK</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Chatter</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">set_timestamp</span><span class="p">(</span><span class="n">Time</span><span class="o">::</span><span class="n">Now</span><span class="p">().</span><span class="n">ToNanosecond</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">set_lidar_timestamp</span><span class="p">(</span><span class="n">Time</span><span class="o">::</span><span class="n">Now</span><span class="p">().</span><span class="n">ToNanosecond</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">set_seq</span><span class="p">(</span><span class="n">seq</span><span class="o">++</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">set_content</span><span class="p">(</span><span class="s">&quot;Hello, apollo!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">talker</span><span class="o">-&gt;</span><span class="n">Write</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">AINFO</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;talker sent a message!&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">rate</span><span class="p">.</span><span class="n">Sleep</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>ROS</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ros/ros.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;chatter.pb.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;talker&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span><span class="w"> </span><span class="n">chatter_pub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">pb_msgs</span><span class="o">::</span><span class="n">Chatter</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;chatter&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">ros</span><span class="o">::</span><span class="n">Rate</span><span class="w"> </span><span class="n">loop_rate</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">pb_msgs</span><span class="o">::</span><span class="n">Chatter</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">::</span><span class="n">now</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">mutable_stamp</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_sec</span><span class="p">(</span><span class="n">now</span><span class="p">.</span><span class="n">sec</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">mutable_stamp</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_nsec</span><span class="p">(</span><span class="n">now</span><span class="p">.</span><span class="n">nsec</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Hello world &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">set_content</span><span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">chatter_pub</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">spinOnce</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">loop_rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Most of the mappings are illustrated in listener code above, the rest are listed here.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ros::Publisher</span> <span class="pre">chatter_pub</span> <span class="pre">=</span> <span class="pre">n.advertise&lt;pb_msgs::Chatter&gt;(&quot;chatter&quot;,</span> <span class="pre">1000);</span></code> –&gt; <code class="docutils literal notranslate"><span class="pre">auto</span> <span class="pre">talker</span> <span class="pre">=</span> <span class="pre">talker_node-&gt;CreateWriter&lt;Chatter&gt;(&quot;channel/chatter&quot;);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chatter_pub.publish(msg);</span></code> –&gt; <code class="docutils literal notranslate"> <span class="pre">talker-&gt;Write(msg);</span></code></p></li>
</ul>
</section>
</section>
<section id="tools-mapping">
<h2>Tools mapping<a class="headerlink" href="#tools-mapping" title="永久链接至标题">¶</a></h2>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>ROS</p></th>
<th class="text-align:left head"><p>Cyber RT</p></th>
<th class="text-align:left head"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>rosbag</p></td>
<td class="text-align:left"><p>cyber_recorder</p></td>
<td class="text-align:left"><p>data file</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>scripts/diagnostics.sh</p></td>
<td class="text-align:left"><p>cyber_monitor</p></td>
<td class="text-align:left"><p>channel debug</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>offline_lidar_visualizer_tool</p></td>
<td class="text-align:left"><p>cyber_visualizer</p></td>
<td class="text-align:left"><p>point cloud visualizer</p></td>
</tr>
</tbody>
</table>
</section>
<section id="ros-bag-data-migration">
<h2>ROS bag data migration<a class="headerlink" href="#ros-bag-data-migration" title="永久链接至标题">¶</a></h2>
<p>The data file changed from ROS bag to Cyber record in Cyber RT. Cyber RT has a data migration tool <code class="docutils literal notranslate"><span class="pre">rosbag_to_record</span></code> for users to easily migrate data files before Apollo 3.0 (ROS) to Cyber RT like the sample usage below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rosbag_to_record demo_3.0.bag demo_3.5.record
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="CyberRT_Python_API.html" title="erer"
             >下一页</a> |</li>
        <li class="right" >
          <a href="CyberRT_FAQs.html" title="Apollo Cyber RT FAQs"
             >上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Migration guide from Apollo ROS</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2021, xinetzone.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>