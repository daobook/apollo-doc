
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>rf &#8212; Sphinx documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx13.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/translations.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="canonical" href="https://www.sphinx-doc.org/en/master/docs/howto/how_to_monitor_perf_with_oprofile_on_tx2.html" />
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Sphinx documentation 中搜索"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.svg"/>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="ff" href="how_to_monitor_perf_with_oprofile_on_tx2_cn.html" />
    <link rel="prev" title="How to Leverage Scenario Editor" href="how_to_leverage_scenario_editor.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script>
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../../README.html">Home</a></li>
    <li><a href="../quickstart/README.html">Get it</a></li>
    <li><a href="../../contents.html">Docs</a></li>
    <li><a href="../../development/index.html">Extend</a></li>
  </ul>
  <div>
    <a href="../../README.html">
      <img src="../../_static/sphinx.png" alt="Apollo Doc" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="how_to_monitor_perf_with_oprofile_on_tx2_cn.html" title="ff"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="how_to_leverage_scenario_editor.html" title="How to Leverage Scenario Editor"
             accesskey="P">上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">rf</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">rf</a><ul>
<li><a class="reference internal" href="#download">Download</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#test">Test</a></li>
<li><a class="reference internal" href="#how-to-use">How to use</a></li>
<li><a class="reference internal" href="#output">Output</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="how_to_leverage_scenario_editor.html"
                        title="上一章">How to Leverage Scenario Editor</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="how_to_monitor_perf_with_oprofile_on_tx2_cn.html"
                        title="下一章">ff</a></p>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/docs/howto/how_to_monitor_perf_with_oprofile_on_tx2.md.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="rf">
<h1>rf<a class="headerlink" href="#rf" title="永久链接至标题">¶</a></h1>
<p>oprofile is a performance monitoring tool that runs on linux system. Generally, oprofile has been included in linux system modules, but oprofile module is not supported on ARM, so we have to install it manually.</p>
<p>oprofile supports multi-thread program. It records the number of function calls, and can also output the source code to show results user-friendly. So it fits well to performance monitoring on TX2.</p>
<section id="download">
<h2>Download<a class="headerlink" href="#download" title="永久链接至标题">¶</a></h2>
<p>Download the newest version of oprofile</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ wget http://prdownloads.sourceforge.net/oprofile/oprofile-1.4.0.tar.gz
$ tar zxvf oprofile-1.4.0.tar.gz
$ <span class="nb">cd</span> oprofile-1.4.0
</pre></div>
</div>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="永久链接至标题">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install libpopt-dev libiberty-dev binutils-dev
$ ./configure
$ make -j4
$ sudo make install
</pre></div>
</div>
</section>
<section id="test">
<h2>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h2>
<p>After installation，perform command <code class="docutils literal notranslate"><span class="pre">operf</span></code> to see if it could get CPU information normally. If it fails and the output is like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">unable</span> <span class="pre">to</span> <span class="pre">open</span> <span class="pre">/sys/devices/system/cpu/cpu0/online</span></code></p>
<p>This is because TX2 only launches 4 CPU cores by default. The other two CPU cores are closed.
Use below command to open the other two CPU cores:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo nvpmodel -m <span class="m">0</span>
</pre></div>
</div>
</section>
<section id="how-to-use">
<h2>How to use<a class="headerlink" href="#how-to-use" title="永久链接至标题">¶</a></h2>
<p>oprofile provides variety of commands, the commands <code class="docutils literal notranslate"><span class="pre">operf</span></code>, <code class="docutils literal notranslate"><span class="pre">opreport</span></code> and <code class="docutils literal notranslate"><span class="pre">opannotate</span></code> are used more often.
Take testing perception as an example.</p>
<ul class="simple">
<li><p>1.modify <code class="docutils literal notranslate"><span class="pre">script/apollo_bash.sh</span></code>, add command <code class="docutils literal notranslate"><span class="pre">operf</span></code> behind keyword <code class="docutils literal notranslate"><span class="pre">nuhup</span></code> in line 239. As shown below：</p></li>
</ul>
<p><img alt="operf_command" src="../../_images/operf_command.png" /></p>
<ul class="simple">
<li><p>2.use script like <code class="docutils literal notranslate"><span class="pre">./script/perception.sh</span></code> to launch perception program</p></li>
</ul>
<p>And now, operf is collecting data of perception program. Stopping perception program in any approach can stop the collecting process.</p>
</section>
<section id="output">
<h2>Output<a class="headerlink" href="#output" title="永久链接至标题">¶</a></h2>
<p>After stopping perception program, a directory named oprofile_data is generated in current directory.
Use command <code class="docutils literal notranslate"><span class="pre">opreport</span></code> to show the total statistics:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ opreport
</pre></div>
</div>
<p>As shown below:</p>
<p><img alt="opreport_" src="../../_images/opreport_.png" /></p>
<p>Use command <code class="docutils literal notranslate"><span class="pre">opreport</span></code> to show the statistics of each function:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ opreport -l bazel-bin/modules/perception/perception 
</pre></div>
</div>
<p>Because there is too much information to show, so it’s better to save the output into a file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ opreport -l bazel-bin/modules/perception/perception &gt; perception_op_funcs.md
</pre></div>
</div>
<p>As shown below:</p>
<p><img alt="opreport_file" src="../../_images/opreport_file.png" /></p>
<p>Use command <code class="docutils literal notranslate"><span class="pre">opannotate</span></code> to show the statistics with source code:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ opannotate -s bazel-bin/modules/perception/perception &gt; perception_op_details.md
</pre></div>
</div>
<p>Notice:
It only supports one operf program to be running at any time, so when operf program is running, we could launch another program with <code class="docutils literal notranslate"><span class="pre">operf</span></code>.</p>
<p>oprofile official website:
<a class="reference external" href="http://oprofile.sourceforge.net/news/">http://oprofile.sourceforge.net/news/</a></p>
<p>oprofile user manual:
<a class="reference external" href="http://oprofile.sourceforge.net/doc/index.html">http://oprofile.sourceforge.net/doc/index.html</a></p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="how_to_monitor_perf_with_oprofile_on_tx2_cn.html" title="ff"
             >下一页</a> |</li>
        <li class="right" >
          <a href="how_to_leverage_scenario_editor.html" title="How to Leverage Scenario Editor"
             >上一页</a> |</li>
        <li><a href="../../index.html">Apollo home</a>&#160;|</li>
        <li><a href="../../contents.html">Documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">rf</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2021, xinetzone.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>